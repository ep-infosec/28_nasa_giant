
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>giant.stellar_opnav.visualizer &#8212; GIANT 1.0.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../../_static/logo.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="copyright" title="Copyright" href="../../../copyright.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../../../index.html">
    <img class="logo" src="../../../_static/logo.png" alt="Logo"/>
    
  </a>
</p>



<p class="blurb">A powerful API for Optical Navigation</p>






<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installing GIANT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../giant.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../giant.html#indices">Indices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../copyright.html">Copyright</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
              <div class="related top">
                &nbsp;
  <nav id="rellinks">
    <ul>
    </ul>
  </nav>
              </div>
          

          <div class="body" role="main">
            
  <h1>Source code for giant.stellar_opnav.visualizer</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright 2021 United States Government as represented by the Administrator of the National Aeronautics and Space</span>
<span class="c1"># Administration.  No copyright is claimed in the United States under Title 17, U.S. Code. All Other Rights Reserved.</span>


<span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module provides utilities for visually inspecting star identification and attitude estimation results.</span>

<span class="sd">In general, the only functions a user will directly interface with from this module are the :func:`show_id_results`</span>
<span class="sd">which shows the results of performing star identification and attitude estimation, :func:`residual_histograms` which</span>
<span class="sd">shows histograms of the residuals, and :func:`plot_residuals_vs_magnitude` which generates a scatter plot of residuals</span>
<span class="sd">as a function of star magnitude.  The other contents of this model are used for manual outlier inspection, which is</span>
<span class="sd">typically done by using the :meth:`~.StellarOpNav.review_outliers` method.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.widgets</span> <span class="kn">import</span> <span class="n">Button</span>
<span class="kn">from</span> <span class="nn">matplotlib.backends.backend_pdf</span> <span class="kn">import</span> <span class="n">PdfPages</span>
<span class="kn">from</span> <span class="nn">matplotlib.figure</span> <span class="kn">import</span> <span class="n">Figure</span>

<span class="kn">from</span> <span class="nn">giant._typing</span> <span class="kn">import</span> <span class="n">PATH</span>

<span class="kn">from</span> <span class="nn">giant.stellar_opnav.stellar_class</span> <span class="kn">import</span> <span class="n">StellarOpNav</span>


<div class="viewcode-block" id="show_id_results"><a class="viewcode-back" href="../../../stellar_opnav/visualizer/giant.stellar_opnav.visualizer.show_id_results.html#giant.stellar_opnav.visualizer.show_id_results">[docs]</a><span class="k">def</span> <span class="nf">show_id_results</span><span class="p">(</span><span class="n">sopnav</span><span class="p">:</span> <span class="n">StellarOpNav</span><span class="p">,</span> <span class="n">pdf_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PATH</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">flattened_image</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">log_scale</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function generates a figure for each turned on image in ``sopnav`` showing the star identification results, as</span>
<span class="sd">    well as a couple figures showing the residuals between the predicted catalogue star locations and the image star</span>
<span class="sd">    locations for all images combined.</span>

<span class="sd">    For each individual figure, the matched catalogue projected star locations are shown with one marker, the matched</span>
<span class="sd">    image points of interest are shown with another marker, the unmatched catalogue projected star locations in the</span>
<span class="sd">    field of view are shown with another marker, and the unmatched image points of interest are shown with another</span>
<span class="sd">    marker.  In addition, an array is drawn indicating the residuals for the match star pairs.</span>

<span class="sd">    You must have called :meth:`~.StellarOpNav.id_stars` at least once before calling this function.</span>

<span class="sd">    If ``pdf_name`` param is not ``None``, the figures will be saved to a pdf file of the same name.</span>

<span class="sd">    If ``flattened_image`` is set to True, then the individual figures will show the flattened image that is used for</span>
<span class="sd">    initial detection of possible stars in the image.  Typically this should be left to ``False`` unless you are having</span>
<span class="sd">    issues finding stars and want to inspect the image to see what is going on.</span>

<span class="sd">    If ``log_scale`` is set to ``True`` then the individual images are shown using a logarithmic scale to help make</span>
<span class="sd">    stars stand out more from the background.  This is generally a fairly useful feature and is used frequently.</span>

<span class="sd">    .. warning::</span>
<span class="sd">        This function generates 1 figure for every image in your :class:`.StellarOpNav` instance, which can really slow</span>
<span class="sd">        down your computer if you have a lot of images loaded and turned on.  To avoid this problem, try turning some of</span>
<span class="sd">        the images off using the :attr:`~.Camera.image_mask` attribute before using this function, or save to</span>
<span class="sd">        pdf instead.</span>

<span class="sd">    :param sopnav: The :class:`.StellarOpNav` instance containing the star identification results</span>
<span class="sd">    :param pdf_name: Label of the star id results to be shown. Used as the file name for saving figures to pdf</span>
<span class="sd">    :param flattened_image: A boolean flag specifying whether to show the flattened image instead of the raw image</span>
<span class="sd">    :param log_scale: A boolean flag specifying whether to use a logarithmic scale for the image intensity values.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">all_resids_fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">all_resids_fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
    <span class="n">big_resids</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="n">pdf_name</span><span class="p">:</span>
        <span class="n">pdf</span> <span class="o">=</span> <span class="n">PdfPages</span><span class="p">(</span><span class="n">pdf_name</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pdf</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">sopnav</span><span class="o">.</span><span class="n">camera</span><span class="p">:</span>
        <span class="n">cat_locations</span> <span class="o">=</span> <span class="n">sopnav</span><span class="o">.</span><span class="n">matched_catalogue_image_points</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">flattened_image</span><span class="p">:</span>
            <span class="n">image</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">sopnav</span><span class="o">.</span><span class="n">image_processing</span><span class="o">.</span><span class="n">flatten_image_and_get_noise_level</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
            <span class="c1"># make the min of the image 100</span>
            <span class="n">image</span> <span class="o">-=</span> <span class="n">image</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="mi">100</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">axt</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">log_scale</span><span class="p">:</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">-</span> <span class="n">image</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">+</span> <span class="mi">100</span>
            <span class="n">axt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">image</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">axt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">cat_locations</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="n">cat_locations</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
            <span class="n">resids</span> <span class="o">=</span> <span class="n">cat_locations</span> <span class="o">-</span> <span class="n">sopnav</span><span class="o">.</span><span class="n">matched_extracted_image_points</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>

            <span class="c1"># # Plot Matched Pairs</span>
            <span class="n">axt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="o">*</span><span class="n">sopnav</span><span class="o">.</span><span class="n">matched_extracted_image_points</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;yellow&#39;</span><span class="p">,</span>
                        <span class="n">linewidths</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Matched Centroids&#39;</span><span class="p">)</span>
            <span class="n">axt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="o">*</span><span class="n">cat_locations</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Matched Catalog&#39;</span><span class="p">)</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">sopnav</span><span class="o">.</span><span class="n">matched_extracted_image_points</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">cat_locations</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">str_</span><span class="p">)):</span>
                <span class="n">axt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

            <span class="n">big_resids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">resids</span><span class="p">)</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="o">*</span><span class="n">sopnav</span><span class="o">.</span><span class="n">matched_extracted_image_points</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="o">*</span><span class="n">resids</span><span class="p">,</span> <span class="n">angles</span><span class="o">=</span><span class="s1">&#39;xy&#39;</span><span class="p">,</span> <span class="n">scale_units</span><span class="o">=</span><span class="s1">&#39;xy&#39;</span><span class="p">,</span>
                      <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.0005</span><span class="p">,</span> <span class="n">headwidth</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">headlength</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

        <span class="n">in_fov</span> <span class="o">=</span> <span class="p">((</span><span class="n">sopnav</span><span class="o">.</span><span class="n">unmatched_catalogue_image_points</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span>
                  <span class="p">(</span><span class="n">sopnav</span><span class="o">.</span><span class="n">unmatched_catalogue_image_points</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="p">[[</span><span class="n">sopnav</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">n_cols</span><span class="p">],</span>
                                                                    <span class="p">[</span><span class="n">sopnav</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">n_rows</span><span class="p">]]))</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Plot Unmatched Pairs</span>
        <span class="n">axt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="o">*</span><span class="n">sopnav</span><span class="o">.</span><span class="n">unmatched_extracted_image_points</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span>
                    <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Unmatched Centroids&#39;</span><span class="p">)</span>
        <span class="n">axt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">sopnav</span><span class="o">.</span><span class="n">unmatched_catalogue_image_points</span><span class="p">[</span><span class="n">ind</span><span class="p">][:,</span> <span class="n">in_fov</span><span class="p">]),</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span>
                    <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;cyan&#39;</span><span class="p">,</span>
                    <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Unmatched Catalog&#39;</span><span class="p">)</span>
        <span class="n">axt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span><span class="o">.</span><span class="n">set_draggable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Observation Date: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">observation_date</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">pdf_name</span><span class="p">:</span>
            <span class="n">pdf</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">big_resids</span><span class="p">:</span>
        <span class="n">big_resids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">big_resids</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">sopnav</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">n_cols</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">sopnav</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">n_rows</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;columns, pix&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;rows, pix&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Residuals All Images</span><span class="se">\n</span><span class="s1"> &#39;</span>
                     <span class="s1">&#39;std = (</span><span class="si">{0:5.3f}</span><span class="s1">, </span><span class="si">{1:5.3f}</span><span class="s1">) &#39;</span>
                     <span class="s1">&#39;mean = (</span><span class="si">{2:5.3f}</span><span class="s1">, </span><span class="si">{3:5.3f}</span><span class="s1">) pixels&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">big_resids</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                                                                 <span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">big_resids</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)))</span>
        <span class="nb">print</span><span class="p">(</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">big_resids</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">big_resids</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">pdf_name</span><span class="p">:</span>
        <span class="n">pdf</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">all_resids_fig</span><span class="p">)</span>
        <span class="n">pdf</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">all_resids_fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">pdf_name</span> <span class="o">+</span> <span class="s1">&#39;_combined_resids.pdf&#39;</span><span class="p">)</span>
        <span class="n">all_resids_fig</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">all_resids_fig</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="residual_histograms"><a class="viewcode-back" href="../../../stellar_opnav/visualizer/giant.stellar_opnav.visualizer.residual_histograms.html#giant.stellar_opnav.visualizer.residual_histograms">[docs]</a><span class="k">def</span> <span class="nf">residual_histograms</span><span class="p">(</span><span class="n">sopnav</span><span class="p">:</span> <span class="n">StellarOpNav</span><span class="p">,</span> <span class="n">individual_images</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">pdf_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PATH</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function generates histograms of the matched star residuals for a given stellar opnav object.</span>

<span class="sd">    Typically, 3 histograms are created in a single figure.  The first shows the histogram of all residuals (both column</span>
<span class="sd">    and row) for all images. The second shows the histogram of just the column residuals for all images. The third shows</span>
<span class="sd">    the histogram of just the row residuals for all images. Optionally, if you specify ``individual_images`` to be</span>
<span class="sd">    ``True`` then this function will generate a single figure for each image turned on in ``sopnav`` showing the three</span>
<span class="sd">    histograms described previously.  If using this option it is recommended to save the plots to a PDF instead of</span>
<span class="sd">    showing interactively because many figures would be opened, possibly causing your compute to slow down.</span>

<span class="sd">    You must have called :meth:`~.StellarOpNav.id_stars` at least once before calling this function.</span>

<span class="sd">    If the ``pdf_name`` param is provided, the figures will be saved to a pdf file of the same name, and will not be</span>
<span class="sd">    displayed interactively.</span>

<span class="sd">    :param sopnav: The stellar opnav object to plot the histograms for</span>
<span class="sd">    :param individual_images: A flag specifying whether to generate a single histogram for all images or no</span>
<span class="sd">    :param pdf_name: Used as the file name for saving the figures to a pdf</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">pdf_name</span><span class="p">:</span>
        <span class="n">pdf</span> <span class="o">=</span> <span class="n">PdfPages</span><span class="p">(</span><span class="n">pdf_name</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pdf</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">column_residuals</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">row_residuals</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">all_residuals</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">image_residuals</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">sopnav</span><span class="o">.</span><span class="n">camera</span><span class="p">:</span>
        <span class="n">residuals</span> <span class="o">=</span> <span class="n">sopnav</span><span class="o">.</span><span class="n">matched_star_residuals</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">individual_images</span><span class="p">:</span>
            <span class="n">image_residuals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">residuals</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">residuals</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="n">residuals</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
            <span class="n">column_residuals</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">residuals</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">row_residuals</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">residuals</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">all_residuals</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">residuals</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">all_residuals</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">residuals</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">all_residuals</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">column_residuals</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;column&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">row_residuals</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;row&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Residual Histogram All Images</span><span class="se">\n</span><span class="s1">&#39;</span>
              <span class="s1">&#39;STD (Total (column, row)) = </span><span class="si">{:.3g}</span><span class="s1"> (</span><span class="si">{:.3g}</span><span class="s1">, </span><span class="si">{:.3g}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">all_residuals</span><span class="p">),</span>
                                                                           <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">column_residuals</span><span class="p">),</span>
                                                                           <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">row_residuals</span><span class="p">)))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Residuals, pix&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Count&#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span><span class="o">.</span><span class="n">draggable</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span><span class="o">.</span><span class="n">set_draggable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">pdf_name</span><span class="p">:</span>
        <span class="n">pdf</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">individual_images</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">sopnav</span><span class="o">.</span><span class="n">camera</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">image_residuals</span><span class="p">[</span><span class="n">ind</span><span class="p">]:</span>
                <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
                <span class="n">residuals</span> <span class="o">=</span> <span class="n">image_residuals</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">residuals</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">residuals</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;column&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">residuals</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;row&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
                    <span class="s1">&#39;Residual Histogram Images </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span>
                    <span class="s1">&#39;STD (Total (column, row)) = </span><span class="si">{:.3g}</span><span class="s1"> (</span><span class="si">{:.3g}</span><span class="s1">, </span><span class="si">{:.3g}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">observation_date</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
                                                                                 <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">residuals</span><span class="o">.</span><span class="n">ravel</span><span class="p">()),</span>
                                                                                 <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">residuals</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                                                                                 <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">residuals</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Residuals, pix&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Count&#39;</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span><span class="o">.</span><span class="n">draggable</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span><span class="o">.</span><span class="n">set_draggable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">pdf_name</span><span class="p">:</span>
                    <span class="n">pdf</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">pdf_name</span><span class="p">:</span>
        <span class="n">pdf</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="plot_residuals_vs_magnitude"><a class="viewcode-back" href="../../../stellar_opnav/visualizer/giant.stellar_opnav.visualizer.plot_residuals_vs_magnitude.html#giant.stellar_opnav.visualizer.plot_residuals_vs_magnitude">[docs]</a><span class="k">def</span> <span class="nf">plot_residuals_vs_magnitude</span><span class="p">(</span><span class="n">sopnav</span><span class="p">:</span> <span class="n">StellarOpNav</span><span class="p">,</span> <span class="n">individual_images</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">pdf_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PATH</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function generates a scatter plot of x and y residuals versus star magnitudes from the matched catalogue</span>
<span class="sd">    stars for a given stellar opnav object.</span>

<span class="sd">    Generally, this function will generate a single scatter plot showing the residuals vs magnitude across all images,</span>
<span class="sd">    however, if you specify ``individual_images`` as ``True``, then in addition to the summary plot, a single plot will</span>
<span class="sd">    be made showing the residuals vs magnitude for each image.</span>

<span class="sd">    You must have called :meth:`~.StellarOpNav.id_stars` at least once before calling this function.</span>

<span class="sd">    If the ``pdf_name`` param is provided, the figures will be saved to a pdf file of the same name, and will not be</span>
<span class="sd">    displayed interactively.</span>

<span class="sd">    :param sopnav: The stellar opnav object to plot the scatters for</span>
<span class="sd">    :param individual_images: A flag specifying whether to generate individual plots for each image in addition to the</span>
<span class="sd">                              plot spanning all images</span>
<span class="sd">    :param pdf_name: Used as the file name for saving the figures to a pdf</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">pdf_name</span><span class="p">:</span>
        <span class="n">pdf</span> <span class="o">=</span> <span class="n">PdfPages</span><span class="p">(</span><span class="n">pdf_name</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pdf</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">column_residuals</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">row_residuals</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">all_residuals</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">image_residuals</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">star_magnitudes</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">sopnav</span><span class="o">.</span><span class="n">camera</span><span class="p">:</span>
        <span class="n">residuals</span> <span class="o">=</span> <span class="n">sopnav</span><span class="o">.</span><span class="n">matched_star_residuals</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">individual_images</span><span class="p">:</span>
            <span class="n">image_residuals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">residuals</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">residuals</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="n">residuals</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
            <span class="n">column_residuals</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">residuals</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">row_residuals</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">residuals</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">all_residuals</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">residuals</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">all_residuals</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">residuals</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">star_magnitudes</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">sopnav</span><span class="o">.</span><span class="n">matched_catalogue_star_records</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;mag&#39;</span><span class="p">])</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">star_magnitudes</span><span class="p">,</span> <span class="n">column_residuals</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;column&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">star_magnitudes</span><span class="p">,</span> <span class="n">row_residuals</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;row&#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span><span class="o">.</span><span class="n">draggable</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span><span class="o">.</span><span class="n">set_draggable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Residuals vs. Star Magnitude&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Star Magnitude&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Residual, pix&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">pdf_name</span><span class="p">:</span>
        <span class="n">pdf</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">individual_images</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">sopnav</span><span class="o">.</span><span class="n">camera</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">image_residuals</span><span class="p">[</span><span class="n">ind</span><span class="p">]:</span>
                <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
                <span class="n">residuals</span> <span class="o">=</span> <span class="n">image_residuals</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
                <span class="n">mags</span> <span class="o">=</span> <span class="n">sopnav</span><span class="o">.</span><span class="n">matched_catalogue_star_records</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;mag&quot;</span><span class="p">]</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">mags</span><span class="p">,</span> <span class="n">residuals</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;column&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">mags</span><span class="p">,</span> <span class="n">residuals</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;row&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Residual vs Star Magnitude Image </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">observation_date</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()))</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Star Magnitude&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Residual, pix&#39;</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span><span class="o">.</span><span class="n">draggable</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span><span class="o">.</span><span class="n">set_draggable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">pdf_name</span><span class="p">:</span>
                    <span class="n">pdf</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">pdf_name</span><span class="p">:</span>
        <span class="n">pdf</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="plot_residuals_vs_temperature"><a class="viewcode-back" href="../../../stellar_opnav/visualizer/giant.stellar_opnav.visualizer.plot_residuals_vs_temperature.html#giant.stellar_opnav.visualizer.plot_residuals_vs_temperature">[docs]</a><span class="k">def</span> <span class="nf">plot_residuals_vs_temperature</span><span class="p">(</span><span class="n">sopnav</span><span class="p">:</span> <span class="n">StellarOpNav</span><span class="p">,</span> <span class="n">pdf_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PATH</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function generates a scatter plot of x and y residuals versus image temperature from the matched catalogue</span>
<span class="sd">    stars for a given stellar opnav object.</span>

<span class="sd">    You must have called :meth:`~.StellarOpNav.id_stars` at least once before calling this function.</span>

<span class="sd">    If the ``pdf_name`` param is provided, the figures will be saved to a pdf file of the same name, and will not be</span>
<span class="sd">    displayed interactively.</span>

<span class="sd">    :param sopnav: The stellar opnav object to plot the scatters for</span>
<span class="sd">    :param pdf_name: Used as the file name for saving the figures to a pdf</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">x_residuals</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">y_residuals</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">temperatures</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">sopnav</span><span class="o">.</span><span class="n">camera</span><span class="p">:</span>
        <span class="n">residuals</span> <span class="o">=</span> <span class="n">sopnav</span><span class="o">.</span><span class="n">matched_star_residuals</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">residuals</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="n">residuals</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
            <span class="n">x_residuals</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">residuals</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">y_residuals</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">residuals</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="n">temperatures</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">image</span><span class="o">.</span><span class="n">temperature</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">residuals</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">temperatures</span><span class="p">,</span> <span class="n">x_residuals</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;column&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">temperatures</span><span class="p">,</span> <span class="n">y_residuals</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;row&#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span><span class="o">.</span><span class="n">draggable</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span><span class="o">.</span><span class="n">set_draggable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Residuals vs. Star Magnitude&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Temperature, deg C&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Residual, pix&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">pdf_name</span><span class="p">:</span>
        <span class="n">pdf</span> <span class="o">=</span> <span class="n">PdfPages</span><span class="p">(</span><span class="n">pdf_name</span><span class="p">)</span>
        <span class="n">pdf</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="n">pdf</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="OutlierCallback"><a class="viewcode-back" href="../../../stellar_opnav/visualizer/giant.stellar_opnav.visualizer.OutlierCallback.html#giant.stellar_opnav.visualizer.OutlierCallback">[docs]</a><span class="k">class</span> <span class="nc">OutlierCallback</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The class is used to represent an outlier shown to the user for review via the function :func:`show_outlier`</span>
<span class="sd">    and to store the user&#39;s choice whether or not to remove the outlier from the matched star pairs.</span>

<span class="sd">    This typically is not used by the user directly.  See :meth:`~.StellarOpNav.review_residuals` or</span>
<span class="sd">    :func:`show_outlier` instead.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outlier_number</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">image_number</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">centroid</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">plot</span><span class="p">:</span> <span class="n">Figure</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param outlier_number: The index of the outlier in the ``matched_`` properties of the :class:`StellarOpNav`</span>
<span class="sd">                               class</span>
<span class="sd">        :param image_number: The index of the image in the :attr:`camera` attribute of a :class:`.StellarOpNav`</span>
<span class="sd">                             instance where the outlier represented by :class:`OutlierCallback` was found</span>
<span class="sd">        :param centroid: The pixel coordinates of the outlier in the image</span>
<span class="sd">        :param plot: The plot of the outlier</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">outlier_number</span> <span class="o">=</span> <span class="n">outlier_number</span>  <span class="c1"># type: int</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The number of the outlier in the image</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">image_number</span> <span class="o">=</span> <span class="n">image_number</span>  <span class="c1"># type: int</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Image number</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">centroid</span> <span class="o">=</span> <span class="n">centroid</span>  <span class="c1"># type: np.ndarray</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Observed location</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span> <span class="o">=</span> <span class="n">plot</span>  <span class="c1"># type: Figure</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The plot which shows the outlier in question</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">removed</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># type: bool</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A flag specifying whether the outlier has been removed by the user</span>
<span class="sd">        &quot;&quot;&quot;</span>

<div class="viewcode-block" id="OutlierCallback.remove"><a class="viewcode-back" href="../../../stellar_opnav/visualizer/giant.stellar_opnav.visualizer.OutlierCallback.html#giant.stellar_opnav.visualizer.OutlierCallback.remove">[docs]</a>    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method sets the removed flag to 1 and closes the plot.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">removed</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;You have Removed Star </span><span class="si">{}</span><span class="s1"> (</span><span class="si">{:.2f}</span><span class="s1">, </span><span class="si">{:.2f}</span><span class="s1">) from Consideration in Image </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outlier_number</span><span class="p">,</span>
                                                                                                <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">centroid</span><span class="p">,</span>
                                                                                                <span class="bp">self</span><span class="o">.</span><span class="n">image_number</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">)</span></div>

<div class="viewcode-block" id="OutlierCallback.keep"><a class="viewcode-back" href="../../../stellar_opnav/visualizer/giant.stellar_opnav.visualizer.OutlierCallback.html#giant.stellar_opnav.visualizer.OutlierCallback.keep">[docs]</a>    <span class="k">def</span> <span class="nf">keep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method closes the plot.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="show_outlier"><a class="viewcode-back" href="../../../stellar_opnav/visualizer/giant.stellar_opnav.visualizer.show_outlier.html#giant.stellar_opnav.visualizer.show_outlier">[docs]</a><span class="k">def</span> <span class="nf">show_outlier</span><span class="p">(</span><span class="n">sopnav</span><span class="p">:</span> <span class="n">StellarOpNav</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                 <span class="n">image_num</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">residuals</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OutlierCallback</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function generates a figure for a specified outlier in the given image number in ``sopnav``.</span>

<span class="sd">    In the generated figure the matched catalogue projected star location is shown with one marker, and the matched</span>
<span class="sd">    image point of interest is shown with another. In addition, a vector is drawn indicating the residual</span>
<span class="sd">    for the matched star pair.</span>

<span class="sd">    You must have called :meth:`~.StellarOpNav.id_stars` at least once before calling this function.</span>

<span class="sd">    :param sopnav: The :class:`.StellarOpNav` instance containing the star identification results</span>
<span class="sd">    :param index: The index of the outlier</span>
<span class="sd">    :param image_num: The index of the image in the :attr:`.StellarOpNav.camera` attribute</span>
<span class="sd">    :param residuals: np.ndarray of the residuals between the matched catalogue projected star locations and the</span>
<span class="sd">                      matched image points of interest for the given image number in the :attr:`.StellarOpNav.camera`</span>
<span class="sd">                      attribute</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">w</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># image zoom window size...num pixels to left and right of centroid</span>

    <span class="n">cat_locations</span> <span class="o">=</span> <span class="n">sopnav</span><span class="o">.</span><span class="n">matched_catalogue_image_points</span><span class="p">[</span><span class="n">image_num</span><span class="p">]</span>
    <span class="n">outlier_image</span> <span class="o">=</span> <span class="n">sopnav</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="n">image_num</span><span class="p">]</span>
    <span class="n">centroid</span> <span class="o">=</span> <span class="n">sopnav</span><span class="o">.</span><span class="n">matched_extracted_image_points</span><span class="p">[</span><span class="n">image_num</span><span class="p">][:,</span> <span class="n">index</span><span class="p">]</span>
    <span class="n">c0</span> <span class="o">=</span> <span class="n">centroid</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">c1</span> <span class="o">=</span> <span class="n">centroid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">outlier_fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">a</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">outlier_image</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
    <span class="n">a</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="o">*</span><span class="n">cat_locations</span><span class="p">[:,</span> <span class="n">index</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Catalog&#39;</span><span class="p">)</span>
    <span class="n">a</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">c0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Centroid&#39;</span><span class="p">)</span>
    <span class="n">a</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">c1</span> <span class="o">+</span> <span class="mi">5</span><span class="p">,</span> <span class="n">c0</span> <span class="o">-</span> <span class="mi">5</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">residuals</span><span class="p">[:,</span> <span class="n">index</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)),</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
    <span class="n">a</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">c1</span> <span class="o">-</span> <span class="mi">5</span><span class="p">,</span> <span class="n">c0</span> <span class="o">-</span> <span class="mi">5</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">c1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">c0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
    <span class="n">a</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">c0</span><span class="p">,</span> <span class="n">residuals</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">index</span><span class="p">],</span> <span class="n">residuals</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">index</span><span class="p">],</span> <span class="n">angles</span><span class="o">=</span><span class="s1">&#39;xy&#39;</span><span class="p">,</span> <span class="n">scale_units</span><span class="o">=</span><span class="s1">&#39;xy&#39;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">200</span><span class="p">,</span>
             <span class="n">color</span><span class="o">=</span><span class="s1">&#39;yellow&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Residual&#39;</span><span class="p">)</span>
    <span class="n">a</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([(</span><span class="n">c1</span> <span class="o">-</span> <span class="n">w</span><span class="p">),</span> <span class="p">(</span><span class="n">c1</span> <span class="o">+</span> <span class="n">w</span><span class="p">)])</span>
    <span class="n">a</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([(</span><span class="n">c0</span> <span class="o">-</span> <span class="n">w</span><span class="p">),</span> <span class="p">(</span><span class="n">c0</span> <span class="o">+</span> <span class="n">w</span><span class="p">)])</span>
    <span class="n">a</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
    <span class="n">a</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Potential Outliers: Image </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">image_num</span><span class="p">))</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">a</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span><span class="o">.</span><span class="n">draggable</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">a</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span><span class="o">.</span><span class="n">set_draggable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">.1</span><span class="p">,</span> <span class="mf">.05</span><span class="p">])</span>
    <span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">.1</span><span class="p">,</span> <span class="mf">.05</span><span class="p">])</span>

    <span class="n">callback</span> <span class="o">=</span> <span class="n">OutlierCallback</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">image_num</span><span class="p">,</span> <span class="n">centroid</span><span class="p">,</span> <span class="n">outlier_fig</span><span class="p">)</span>
    <span class="n">b1</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="s1">&#39;Remove&#39;</span><span class="p">)</span>
    <span class="n">b1</span><span class="o">.</span><span class="n">on_clicked</span><span class="p">(</span><span class="n">callback</span><span class="o">.</span><span class="n">remove</span><span class="p">)</span>

    <span class="n">b2</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">ax2</span><span class="p">,</span> <span class="s1">&#39;Keep&#39;</span><span class="p">)</span>
    <span class="n">b2</span><span class="o">.</span><span class="n">on_clicked</span><span class="p">(</span><span class="n">callback</span><span class="o">.</span><span class="n">keep</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">callback</span></div>
</pre></div>

          </div>
              <div class="related bottom">
                &nbsp;
  <nav id="rellinks">
    <ul>
    </ul>
  </nav>
              </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;2021 United States Government.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>