
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>giant.utilities.stereophotoclinometry &#8212; GIANT 1.0.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../../_static/logo.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="copyright" title="Copyright" href="../../../copyright.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../../../index.html">
    <img class="logo" src="../../../_static/logo.png" alt="Logo"/>
    
  </a>
</p>



<p class="blurb">A powerful API for Optical Navigation</p>






<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installing GIANT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../giant.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../giant.html#indices">Indices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../copyright.html">Copyright</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
              <div class="related top">
                &nbsp;
  <nav id="rellinks">
    <ul>
    </ul>
  </nav>
              </div>
          

          <div class="body" role="main">
            
  <h1>Source code for giant.utilities.stereophotoclinometry</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright 2021 United States Government as represented by the Administrator of the National Aeronautics and Space</span>
<span class="c1"># Administration.  No copyright is claimed in the United States under Title 17, U.S. Code. All Other Rights Reserved.</span>


<span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module provides a number of classes for interfacing with files used in the Stereophotoclinometry (SPC) software</span>
<span class="sd">suite for performing shape modelling and surface feature navigation.</span>

<span class="sd">This module *does not* provide the same functionality that the SPC software does, instead it just provides the ability</span>
<span class="sd">to view, manipulate, and write SPC files and makes it easy to transform SPC data into a format that GIANT</span>
<span class="sd">can use.  This module does assume some level of familiarity with the SPC software and files, so descriptions</span>
<span class="sd">are brief.  See the SPC wiki for more details at https://web.psi.edu/spc_wiki/HomePage</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">struct</span>  <span class="c1"># we need the struct stuff to handle the conversion to binary</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">from</span> <span class="nn">dateutil</span> <span class="kn">import</span> <span class="n">parser</span>

<span class="kn">from</span> <span class="nn">..ray_tracer.shapes</span> <span class="kn">import</span> <span class="n">Triangle64</span><span class="p">,</span> <span class="n">Triangle32</span>
<span class="kn">from</span> <span class="nn">.._typing</span> <span class="kn">import</span> <span class="n">PATH</span><span class="p">,</span> <span class="n">NONENUM</span><span class="p">,</span> <span class="n">NONEARRAY</span><span class="p">,</span> <span class="n">Real</span>

<span class="n">DATE_FMT</span> <span class="o">=</span> <span class="s1">&#39;%Y %b </span><span class="si">%d</span><span class="s1"> %H:%M:%S.</span><span class="si">%f</span><span class="s1">&#39;</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This is the observation_date format used in SPC summary and nominal files.  It is used to parse and write the dates</span>
<span class="sd">&quot;&quot;&quot;</span>


<div class="viewcode-block" id="Summary"><a class="viewcode-back" href="../../../utilities/stereophotoclinometry/giant.utilities.stereophotoclinometry.Summary.html#giant.utilities.stereophotoclinometry.Summary">[docs]</a><span class="k">class</span> <span class="nc">Summary</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class is used to read/write from the SPC summary (.SUM) files.</span>

<span class="sd">    The summary files represent meta data about an Image.  The image data itself is stored in a corresponding</span>
<span class="sd">    .DAT file which can be read/written with the :class:`Image` class.  When creating an instance of this class,</span>
<span class="sd">    you can enter the ``file_name`` argument, in which case the specified SUM file will be opened and read into the</span>
<span class="sd">    members of this class (if the sum file exists), or you can specify the individual components of the sum file as</span>
<span class="sd">    keyword arguments.  If you specify both an existing SUM file and keyword arguments for the individual</span>
<span class="sd">    components of the SUM file, the keyword arguments will override whatever is read from the file.</span>

<span class="sd">    The documentation for each instance attribute of this class specifies the corresponding location in the SUM file</span>
<span class="sd">    for clarification and reference.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PATH</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">image_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">observation_date</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">num_cols</span><span class="p">:</span> <span class="n">NONENUM</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">num_rows</span><span class="p">:</span> <span class="n">NONENUM</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">min_illum</span><span class="p">:</span> <span class="n">NONENUM</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">max_illum</span><span class="p">:</span> <span class="n">NONENUM</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">focal_length</span><span class="p">:</span> <span class="n">NONENUM</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">principle_point</span><span class="p">:</span> <span class="n">NONEARRAY</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">position_camera_to_target</span><span class="p">:</span> <span class="n">NONEARRAY</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">rotation_target_fixed_to_camera</span><span class="p">:</span> <span class="n">NONEARRAY</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">direction_target_to_sun</span><span class="p">:</span> <span class="n">NONEARRAY</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">intrinsic_matrix</span><span class="p">:</span> <span class="n">NONEARRAY</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">near_dist_params</span><span class="p">:</span> <span class="n">NONEARRAY</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">sig_pos_camera_to_target</span><span class="p">:</span> <span class="n">NONEARRAY</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sig_rot_target_fixed_to_camera</span><span class="p">:</span> <span class="n">NONEARRAY</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param file_name: The path to a summary file to read data from</span>
<span class="sd">        :param image_name: The name of the image this object corresponds to</span>
<span class="sd">        :param observation_date: The utc observation observation_date for the image as a python datetime object</span>
<span class="sd">        :param num_cols: The number of columns in the image array</span>
<span class="sd">        :param num_rows: The number of rows in the image array</span>
<span class="sd">        :param min_illum: The minimum illumination value to allow for an image.  SPC ignores pixels with DN values</span>
<span class="sd">                          below this</span>
<span class="sd">        :param max_illum: The maximum illumination value to allow for an image.  SPC ignores pixels wiht DN values</span>
<span class="sd">                          above this.</span>
<span class="sd">        :param focal_length: The focal length of the camera in units of millimeters</span>
<span class="sd">        :param principle_point: The principal point of the camera (location where the optical axis pierces the image</span>
<span class="sd">                                plane) in units of pixels.</span>
<span class="sd">        :param position_camera_to_target: The vector from the spacecraft to the target in the target body fixed frame as</span>
<span class="sd">                                          a length 3 numpy array</span>
<span class="sd">        :param rotation_target_fixed_to_camera: The 3x3 rotation matrix from the target body fixed frame to the camera</span>
<span class="sd">                                                frame</span>
<span class="sd">        :param direction_target_to_sun: The unit vector from the target to the sun in the target body fixed frame</span>
<span class="sd">        :param intrinsic_matrix: The intrinsic matrix of the camera (see the :mod:`~.pinhole_model` documentation</span>
<span class="sd">                                 for details</span>
<span class="sd">        :param near_dist_params: This obsolete array contains special distortion values for the cameras that were flown</span>
<span class="sd">                                 on NEAR.  This should be all 0 for all modern SPC use.</span>
<span class="sd">        :param sig_pos_camera_to_target: This is the formal uncertainty on the ``position_camera_to_target`` vector</span>
<span class="sd">                                         (1 sigma)</span>
<span class="sd">        :param sig_rot_target_fixed_to_camera: This is the formal uncertainty on the spacecraft pointing</span>
<span class="sd">                                               (roll, pitch, yaw?) (1 sigma)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Optional[PATH]</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The path to the summary file that this object was populated from.</span>
<span class="sd">        </span>
<span class="sd">        This also will be the file that changes are written to if :meth:`.write` is called with no arguments.  </span>
<span class="sd">        </span>
<span class="sd">        Typically this is named according to SUMFILES/*IMAGENAME*.SUM where *IMAGENAME* is replaced with the SPC name</span>
<span class="sd">        of the image.  This can be set to None, a str, or a :class:`Path`.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">image_name</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Optional[str]</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The name of the image this object corresponds to.</span>
<span class="sd">        </span>
<span class="sd">        This corresponds to the first line of the SUM file.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">observation_date</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Optional[datetime]</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The middle of the time in UTC that the image was exposed during as a python datetime object.</span>
<span class="sd">        </span>
<span class="sd">        This corresponds to the second line of the SUM file.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">num_cols</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Optional[int]</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The integer number of columns in the image this Summary object corresponds to.</span>
<span class="sd">        </span>
<span class="sd">        This corresponds to the first value of the line containing ``NPX, NLN, THRSH`` in the SUM file (typically the </span>
<span class="sd">        third line).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Optional[int]</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The integer number of rows in the image this Summary object corresponds to.</span>

<span class="sd">        This corresponds to the second value of the line containing ``NPX, NLN, THRSH`` in the SUM file (typically the </span>
<span class="sd">        third line).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">min_illum</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: NONENUM</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The minimum DN value for a pixel to be used in SPC.</span>
<span class="sd">        </span>
<span class="sd">        Pixels with DN values below this threshold are ignored when computing correlation coefficients and other values</span>
<span class="sd">        in SPC.</span>
<span class="sd">        </span>
<span class="sd">        This corresponds to the third value of the line containing ``NPX, NLN, THRSH`` in the SUM file (typically the </span>
<span class="sd">        third line).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">max_illum</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: NONENUM</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The maximum DN value for a pixel to be used in SPC.</span>

<span class="sd">        Pixels with DN values above this threshold are ignored when computing correlation coefficients and other values</span>
<span class="sd">        in SPC.</span>

<span class="sd">        This corresponds to the fourth value of the line containing ``NPX, NLN, THRSH`` in the SUM file (typically the </span>
<span class="sd">        third line).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">focal_length</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: NONENUM</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The focal length of the camera in units of mm.</span>
<span class="sd">        </span>
<span class="sd">        This corresponds to the first value of the line containing ``MMFL, CTR`` in the SUM file (typically the fourth</span>
<span class="sd">        line).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">princ_point</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># type: np.ndarray</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The principle point of the camera as a length 2 numpy array of floats.</span>
<span class="sd">        </span>
<span class="sd">        This typically corresponds to the :attr:`.PinholeModel.px` and :attr:`.PinholeModel.py` attributes of the</span>
<span class="sd">        Pinhole based camera models in GIANT.  The first component is for the x-axis (columns) and the second component</span>
<span class="sd">        is for the y-axis (rows).</span>
<span class="sd">        </span>
<span class="sd">        This corresponds to the second and third values of the line containing ``MMFL, CTR`` in the SUM file (typically </span>
<span class="sd">        the fourth line).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">position_camera_to_target</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># type: np.ndarray</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The position vector from the spacecraft to the target in target body fixed coordinates at the time of the image</span>
<span class="sd">        with units of kilometers as a length 3 numpy array of floats.</span>
<span class="sd">        </span>
<span class="sd">        This corresponds to all the values of the line containing ``SCOBJ`` in the SUM file (typically the fifth line).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rotation_target_fixed_to_camera</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>  <span class="c1"># type: np.ndarray</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The rotation matrix from the target body fixed frame to the camera frame at the time of the image as a</span>
<span class="sd">        shape 3x3 numpy array of floats.</span>

<span class="sd">        This corresponds to all the values of the lines containing ``CX, CY, CZ`` in the SUM file (typically the </span>
<span class="sd">        sixth through the eighth lines).  The matrix is formed according to ``np.vstack([CX, CY, CZ])`` </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">direction_target_to_sun</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># type: np.ndarray</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The unit vector from the target to the sun in the target body fixed frame at the time of the image as a length</span>
<span class="sd">        3 numpy array of floats.</span>
<span class="sd">        </span>
<span class="sd">        This corresponds to all the values of the line containing ``SZ`` in the sum file (typically the ninth line).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">intrinsic_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>  <span class="c1"># type: np.ndarray</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The intrinsic matrix of the camera as a shape 2x3 numpy array of floats.</span>
<span class="sd">        </span>
<span class="sd">        This has an extra column that is kept for SPC compatibility reasons but which is not used anymore.  Therefore,</span>
<span class="sd">        this does not directly correspond to the :attr:`.PinholeModel.intrinsic_matrix` attribute of the Pinhole model </span>
<span class="sd">        and its subclasses in GIANT, but rather the first 2 columns of this matrix correspond to the first 2 columns of</span>
<span class="sd">        the intrinsic matrix in GIANT and the 3rd column should be discarded.</span>
<span class="sd">        </span>
<span class="sd">        This corresponds to all of the values of the line containing ``K-MATRIX`` in the SUM file (typically the</span>
<span class="sd">        tenth line).  Weirdly this is a row major flattening of the intrinsic matrix in the SUM file.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">near_dist_params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>  <span class="c1"># type: np.ndarray</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The deprecated NEAR distortion parameters.</span>
<span class="sd">        </span>
<span class="sd">        Just leave these at 0.</span>
<span class="sd">        </span>
<span class="sd">        This corresponds to all of the values of the line containing ``DISTORTION`` in the SUM file (typically the </span>
<span class="sd">        eleventh line).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sig_pos_camera_to_target</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># type: np.ndarray</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The formal uncertainty on the position_camera_to_target vector as a length 3 numpy array of floats.</span>
<span class="sd">        </span>
<span class="sd">        The formal uncertainty are the 1 sigma values for each component of the position vector.</span>
<span class="sd">        </span>
<span class="sd">        This corresponds to all of the values of the line containing ``SIGMA_VSO`` in the SUM file (typically the </span>
<span class="sd">        twelfth line).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sig_rot_target_fixed_to_camera</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># type: np.ndarray</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The formal uncertainty on the rotation from the target body frame to the spacecraft frame as a length 3 numpy </span>
<span class="sd">        array of floats.</span>

<span class="sd">        The formal uncertainty are the 1 sigma values.</span>

<span class="sd">        This corresponds to all of the values of the line containing ``SIGMA_PTG`` in the SUM file (typically the </span>
<span class="sd">        thirteenth line).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">landmarks</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A dictionary of observed SPC landmarks and their observed locations in units of pixels.</span>
<span class="sd">        </span>
<span class="sd">        The keys to the dictionary are the SPC landmark names (typically 6 character alpha numeric names) </span>
<span class="sd">        and the values are the pixel location the landmark was identified at in the image. Each value is the x, y or </span>
<span class="sd">        column, row location as a length 2 list of floats </span>
<span class="sd">        </span>
<span class="sd">        This corresponds to all of the lines between ``LANDMARKS`` and ``LIMB FITS`` or ``END FILE`` in the SUM file.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">limb_fits</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A dictionary of observed SPC landmarks that occur on the limb of the target in the image and their observed </span>
<span class="sd">        locations in units of pixels and formal uncertainty.</span>

<span class="sd">        The keys to the dictionary are the SPC landmark names (typically 6 character alpha numeric names) </span>
<span class="sd">        and the values are the pixel location the landmark was identified at in the image followed by the uncertainty of</span>
<span class="sd">        the fit. Each value is the x, y, sigma or </span>
<span class="sd">        column, row, sigma as a length 3 list of floats </span>

<span class="sd">        This corresponds to all of the lines between ``LIMB FITS`` and ``LANDMARKS`` or ``END FILE`` in the SUM file.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span> <span class="o">=</span> <span class="n">file_name</span>

        <span class="c1"># override anything that was manually specified</span>
        <span class="k">if</span> <span class="n">image_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_name</span> <span class="o">=</span> <span class="n">image_name</span>

        <span class="k">if</span> <span class="n">observation_date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">observation_date</span> <span class="o">=</span> <span class="n">observation_date</span>

        <span class="k">if</span> <span class="n">num_cols</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_cols</span> <span class="o">=</span> <span class="n">num_cols</span>

        <span class="k">if</span> <span class="n">num_rows</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span> <span class="o">=</span> <span class="n">num_rows</span>

        <span class="k">if</span> <span class="n">min_illum</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">min_illum</span> <span class="o">=</span> <span class="n">min_illum</span>

        <span class="k">if</span> <span class="n">max_illum</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_illum</span> <span class="o">=</span> <span class="n">max_illum</span>

        <span class="k">if</span> <span class="n">focal_length</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">focal_length</span> <span class="o">=</span> <span class="n">focal_length</span>

        <span class="k">if</span> <span class="n">principle_point</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">princ_point</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">principle_point</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">position_camera_to_target</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">position_camera_to_target</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">position_camera_to_target</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">rotation_target_fixed_to_camera</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rotation_target_fixed_to_camera</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rotation_target_fixed_to_camera</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">direction_target_to_sun</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">direction_target_to_sun</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">direction_target_to_sun</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">intrinsic_matrix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">intrinsic_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">intrinsic_matrix</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">near_dist_params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">near_dist_params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">near_dist_params</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">sig_pos_camera_to_target</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sig_pos_camera_to_target</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sig_pos_camera_to_target</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">sig_rot_target_fixed_to_camera</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sig_rot_target_fixed_to_camera</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sig_rot_target_fixed_to_camera</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="n">comp_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;image_name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_name</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">image_name</span><span class="p">,</span>
                     <span class="s1">&#39;observation_date&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">observation_date</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">observation_date</span><span class="p">,</span>
                     <span class="s1">&#39;num_cols&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_cols</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">num_cols</span><span class="p">,</span>
                     <span class="s1">&#39;num_rows&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">num_rows</span><span class="p">,</span>
                     <span class="s1">&#39;min_illum&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_illum</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">min_illum</span><span class="p">,</span>
                     <span class="s1">&#39;max_illum&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_illum</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">max_illum</span><span class="p">,</span>
                     <span class="s1">&#39;focal_length&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">focal_length</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">focal_length</span><span class="p">,</span>
                     <span class="s1">&#39;princ_point&#39;</span><span class="p">:</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">princ_point</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">princ_point</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
                     <span class="s1">&#39;position_camera_to_target&#39;</span><span class="p">:</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">position_camera_to_target</span> <span class="o">==</span>
                                                   <span class="n">other</span><span class="o">.</span><span class="n">position_camera_to_target</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
                     <span class="s1">&#39;rotation_target_fixed_to_camera&#39;</span><span class="p">:</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rotation_target_fixed_to_camera</span> <span class="o">==</span>
                                                         <span class="n">other</span><span class="o">.</span><span class="n">rotation_target_fixed_to_camera</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
                     <span class="s1">&#39;direction_target_to_sun&#39;</span><span class="p">:</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">direction_target_to_sun</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">direction_target_to_sun</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
                     <span class="s1">&#39;intrinsic_matrix&#39;</span><span class="p">:</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">intrinsic_matrix</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">intrinsic_matrix</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
                     <span class="s1">&#39;near_dist_params&#39;</span><span class="p">:</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">near_dist_params</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">near_dist_params</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
                     <span class="s1">&#39;sig_pos_camera_to_target&#39;</span><span class="p">:</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sig_pos_camera_to_target</span> <span class="o">==</span>
                                                  <span class="n">other</span><span class="o">.</span><span class="n">sig_pos_camera_to_target</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
                     <span class="s2">&quot;sig_rot_target_fixed_to_camera&quot;</span><span class="p">:</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sig_rot_target_fixed_to_camera</span> <span class="o">==</span>
                                                        <span class="n">other</span><span class="o">.</span><span class="n">sig_rot_target_fixed_to_camera</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
                     <span class="s2">&quot;landmarks&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">landmarks</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">landmarks</span><span class="p">,</span>
                     <span class="s2">&quot;limb_fits&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">limb_fits</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">limb_fits</span><span class="p">}</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">comp_dict</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">comp_dict</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

<div class="viewcode-block" id="Summary.read"><a class="viewcode-back" href="../../../utilities/stereophotoclinometry/giant.utilities.stereophotoclinometry.Summary.read.html#giant.utilities.stereophotoclinometry.Summary.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PATH</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method reads data from a SPC SUM file (normally SUMFILES/*IMAGENAME*.SUM) and populates the attributes of</span>
<span class="sd">        this class with that data.</span>

<span class="sd">        If ``file_name`` is not specified the :attr:`file_name` attribute of the class is used instead</span>

<span class="sd">        :param file_name: The file to load the sum data from</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">file_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">file_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">sum_file</span><span class="p">:</span>

                <span class="c1"># parse the name and observation_date lines (first two lines</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">image_name</span> <span class="o">=</span> <span class="n">sum_file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">observation_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">sum_file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">),</span> <span class="n">DATE_FMT</span><span class="p">)</span>

                <span class="c1"># parse the size of the Image and the dynamic range of the Image values</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">sum_file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">num_cols</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_illum</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_illum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
                                                                                             <span class="n">count</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>

                <span class="c1"># parse the focal length and the principal point of the camera</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">sum_file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">focal_length</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">princ_point</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">princ_point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>

                <span class="c1"># parse the spacecraft to object position vector</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">sum_file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">position_camera_to_target</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>

                <span class="c1"># parse the object to camera rotation matrix</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">sum_file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">rotation_target_fixed_to_camera</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>

                <span class="n">line</span> <span class="o">=</span> <span class="n">sum_file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">rotation_target_fixed_to_camera</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>

                <span class="n">line</span> <span class="o">=</span> <span class="n">sum_file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">rotation_target_fixed_to_camera</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>

                <span class="c1"># parse the sun direction vector</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">sum_file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">direction_target_to_sun</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>

                <span class="c1"># parse the intrinsic calibration matrix</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">sum_file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">intrinsic_matrix</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

                <span class="c1"># parse the near distortion parameters</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">sum_file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">near_dist_params</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>

                <span class="c1"># parse the sigma_VSO values</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">sum_file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">sig_pos_camera_to_target</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>

                <span class="c1"># parse the sigma_PTG values</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">sum_file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">sig_rot_target_fixed_to_camera</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>

                <span class="c1"># read in the landmark and limb data</span>
                <span class="k">if</span> <span class="s2">&quot;landmarks&quot;</span> <span class="ow">in</span> <span class="n">sum_file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>

                    <span class="n">line</span> <span class="o">=</span> <span class="n">sum_file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">)</span>

                    <span class="n">maplet_names</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">maplet_image_locs_list</span> <span class="o">=</span> <span class="p">[]</span>

                    <span class="k">while</span> <span class="p">(</span><span class="s1">&#39;end&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;limb&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()):</span>
                        <span class="n">split_line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

                        <span class="n">maplet_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">split_line</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

                        <span class="n">maplet_image_locs_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">split_line</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">split_line</span><span class="p">[</span><span class="mi">2</span><span class="p">])])</span>

                        <span class="n">line</span> <span class="o">=</span> <span class="n">sum_file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">maplet_names</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">landmarks</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">maplet_names</span><span class="p">,</span> <span class="n">maplet_image_locs_list</span><span class="p">))</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">landmarks</span> <span class="o">=</span> <span class="p">{}</span>

                <span class="c1"># read in any limb fits</span>
                <span class="k">if</span> <span class="s1">&#39;limb&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>

                    <span class="n">limb_names</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">limb_image_locs_list</span> <span class="o">=</span> <span class="p">[]</span>

                    <span class="n">line</span> <span class="o">=</span> <span class="n">sum_file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">)</span>

                    <span class="k">while</span> <span class="s1">&#39;end&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                        <span class="n">split_line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

                        <span class="n">limb_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">split_line</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

                        <span class="n">limb_image_locs_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">split_line</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">split_line</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>  <span class="c1"># location</span>
                                                     <span class="nb">float</span><span class="p">(</span><span class="n">split_line</span><span class="p">[</span><span class="mi">3</span><span class="p">])])</span>  <span class="c1"># sigma</span>

                        <span class="n">line</span> <span class="o">=</span> <span class="n">sum_file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">limb_names</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">limb_fits</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">limb_names</span><span class="p">,</span> <span class="n">limb_image_locs_list</span><span class="p">))</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">limb_fits</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s1">&#39;The file </span><span class="si">{}</span><span class="s1"> does not exist.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_name</span><span class="p">))</span></div>

<div class="viewcode-block" id="Summary.write"><a class="viewcode-back" href="../../../utilities/stereophotoclinometry/giant.utilities.stereophotoclinometry.Summary.write.html#giant.utilities.stereophotoclinometry.Summary.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PATH</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function writes the data contained in the current instance of the class into the specified file</span>

<span class="sd">        If the ``file_name`` argument is not specified then it writes to the file stored in the</span>
<span class="sd">        :attr:`~.Summary.file_name` attribute.</span>

<span class="sd">        :param file_name: the full or relative path to the file to be written.  If left as ``None`` then writes to the</span>
<span class="sd">                          file stored in the :attr:`~.Summary.file_name` attribute</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">file_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">file_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;file_name must be specified&#39;</span><span class="p">)</span>

        <span class="n">vector_format</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:20.10E}</span><span class="s1"> </span><span class="si">{1:19.10E}</span><span class="s1"> </span><span class="si">{2:19.10E}</span><span class="s1">   &#39;</span>

        <span class="n">name_line</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:s}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_name</span><span class="p">)</span>

        <span class="n">date_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">observation_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">DATE_FMT</span><span class="p">)[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">image_line</span> <span class="o">=</span> <span class="s1">&#39;  </span><span class="si">{0:4d}</span><span class="s1">  </span><span class="si">{1:4d}</span><span class="s1">   </span><span class="si">{2:3d}</span><span class="s1"> </span><span class="si">{3:5d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_cols</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_illum</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_illum</span>
        <span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="mi">39</span> <span class="o">+</span> <span class="s1">&#39;NPX, NLN, THRSH</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">camera_line</span> <span class="o">=</span> <span class="n">vector_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">focal_length</span><span class="p">,</span>
                                           <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">princ_point</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;MMFL, CTR</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">position_line</span> <span class="o">=</span> <span class="n">vector_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">position_camera_to_target</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;SCOBJ</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">rot_x_line</span> <span class="o">=</span> <span class="n">vector_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">rotation_target_fixed_to_camera</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;CX</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">rot_y_line</span> <span class="o">=</span> <span class="n">vector_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">rotation_target_fixed_to_camera</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;CY</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">rot_z_line</span> <span class="o">=</span> <span class="n">vector_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">rotation_target_fixed_to_camera</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;CZ</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">sun_direction_line</span> <span class="o">=</span> <span class="n">vector_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">direction_target_to_sun</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;SZ</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">intrinsic_line</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:10.5f}</span><span class="s1"> </span><span class="si">{1:9.5f}</span><span class="s1"> </span><span class="si">{2:9.5f}</span><span class="s1"> </span><span class="si">{3:9.5f}</span><span class="s1"> </span><span class="si">{4:9.5f}</span><span class="s1"> </span><span class="si">{5:9.5f}</span><span class="s1">   &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">intrinsic_matrix</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;K-MATRIX</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">distortion_line</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:15.5E}</span><span class="s1"> </span><span class="si">{1:14.5E}</span><span class="s1"> </span><span class="si">{2:14.5E}</span><span class="s1"> </span><span class="si">{3:14.5E}</span><span class="s1">   DISTORTION</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">distortion_line</span> <span class="o">=</span> <span class="n">distortion_line</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">near_dist_params</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">)</span>

        <span class="n">sig_vso_line</span> <span class="o">=</span> <span class="n">vector_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">sig_pos_camera_to_target</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;SIG_VSO</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">sig_ptg_line</span> <span class="o">=</span> <span class="n">vector_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">sig_rot_target_fixed_to_camera</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;SIG_PTG</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">fit_formats</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:6s}</span><span class="s1"> </span><span class="si">{1:9.2f}</span><span class="s1"> </span><span class="si">{2:10.2f}</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">maplet_lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">limb_lines</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">map_name</span><span class="p">,</span> <span class="n">location</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">landmarks</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">maplet_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fit_formats</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">map_name</span><span class="p">,</span> <span class="o">*</span><span class="n">location</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">limb_name</span><span class="p">,</span> <span class="n">location</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">limb_fits</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">limb_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fit_formats</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">limb_name</span><span class="p">,</span> <span class="o">*</span><span class="n">location</span><span class="p">))</span>

        <span class="c1"># open/create the file for writing</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">sum_file</span><span class="p">:</span>

            <span class="n">sum_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">name_line</span><span class="p">)</span>
            <span class="n">sum_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">date_line</span><span class="p">)</span>
            <span class="n">sum_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">image_line</span><span class="p">)</span>
            <span class="n">sum_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">camera_line</span><span class="p">)</span>
            <span class="n">sum_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">position_line</span><span class="p">)</span>
            <span class="n">sum_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">rot_x_line</span><span class="p">)</span>
            <span class="n">sum_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">rot_y_line</span><span class="p">)</span>
            <span class="n">sum_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">rot_z_line</span><span class="p">)</span>
            <span class="n">sum_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">sun_direction_line</span><span class="p">)</span>
            <span class="n">sum_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">intrinsic_line</span><span class="p">)</span>
            <span class="n">sum_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">distortion_line</span><span class="p">)</span>
            <span class="n">sum_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">sig_vso_line</span><span class="p">)</span>
            <span class="n">sum_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">sig_ptg_line</span><span class="p">)</span>
            <span class="n">sum_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;LANDMARKS</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">sum_file</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">maplet_lines</span><span class="p">)</span>
            <span class="n">sum_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;LIMB FITS</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">sum_file</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">limb_lines</span><span class="p">)</span>
            <span class="n">sum_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;END FILE&#39;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="Image"><a class="viewcode-back" href="../../../utilities/stereophotoclinometry/giant.utilities.stereophotoclinometry.Image.html#giant.utilities.stereophotoclinometry.Image">[docs]</a><span class="k">class</span> <span class="nc">Image</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class is used to read and write from SPC Image files (.DAT).</span>

<span class="sd">    The Image files contain the 2D image data for SPC processing.</span>

<span class="sd">    When creating an instance of this class you can enter the ``file_name`` argument and the data will automatically</span>
<span class="sd">    be read from that file.  Alternatively you can specify individual components of the object through key word</span>
<span class="sd">    arguments.  If you provide both key word arguments and a file name then the key word arguments you specified will</span>
<span class="sd">    overwrite anything read from the file.</span>

<span class="sd">    Because the image files are a minimal format, you must specify the number of columns, number of rows, and maximum</span>
<span class="sd">    illumination value in addition to the file name.  These can be determined by reading the corresponding summary file</span>
<span class="sd">    for the image (:class:`.Summary`).  As an alternative to the maximum illumination you can specify the integer size</span>
<span class="sd">    and endianess arguments if known.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PATH</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">n_rows</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">maximum_illumination</span><span class="p">:</span> <span class="n">NONENUM</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">integer_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">endianess</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">data</span><span class="p">:</span> <span class="n">NONEARRAY</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param file_name: The path to a summary file to read data from</span>
<span class="sd">        :param n_cols: The number of columns in the image</span>
<span class="sd">        :param n_rows: The number of rows in the image</span>
<span class="sd">        :param maximum_illumination: The maximum illumination value that is possible in the image.  This is used</span>
<span class="sd">                                     to attempt to discern the endianess of the file, so it typically should be set to</span>
<span class="sd">                                     either 255 for 8 bit or 65535 for 16 bit.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span> <span class="o">=</span> <span class="n">file_name</span>  <span class="c1"># type: Optional[PATH]</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The path to the image file that this object was populated from.</span>

<span class="sd">        This also will be the file that changes are written to if :meth:`.write` is called with no arguments.  </span>

<span class="sd">        Typically this is named according to IMAGEFILES/*IMAGENAME*.DAT where *IMAGENAME* is replaced with the SPC name</span>
<span class="sd">        of the image.  This can be set to None, a str, or a :class:`Path`.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">n_cols</span> <span class="o">=</span> <span class="n">n_cols</span>  <span class="c1"># type: Optional[int]</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The number of columns in the image. </span>
<span class="sd">        </span>
<span class="sd">        This must be specified before the image file is read.  It can be determined by the :attr:`.Summary.n_cols` </span>
<span class="sd">        attribute from the corresponding summary file.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">n_rows</span> <span class="o">=</span> <span class="n">n_rows</span>  <span class="c1"># type: Optional[int]</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The number of rows in the image. </span>

<span class="sd">        This must be specified before the image file is read.  It can be determined by the :attr:`.Summary.n_rows` </span>
<span class="sd">        attribute from the corresponding summary file.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">maximum_illumination</span> <span class="o">=</span> <span class="n">maximum_illumination</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The maximum possible illumination for an image.</span>
<span class="sd">        </span>
<span class="sd">        This is used to try to discern the endianess of the file if it is not known and the file has 16 bit integers, </span>
<span class="sd">        but it is not foolproof.  If you know the endianess of the file you should specify that instead.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">integer_size</span> <span class="o">=</span> <span class="n">integer_size</span>  <span class="c1"># type: Optional[int]</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The number of bytes for each integer in the file.</span>
<span class="sd">        </span>
<span class="sd">        This is discerned from the total number of bytes in the file vs the total number of pixels computed from </span>
<span class="sd">        :attr:`n_rows` and :attr:`n_cols`. A value of 1 indicates an 8 bit integer while a value of 2 indicates a 16 </span>
<span class="sd">        bit integer.  If you know this already then you can specify it to increase reading speed slightly.  </span>
<span class="sd">        </span>
<span class="sd">        This is required to be not ``None`` before a call to write is made.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">endianess</span> <span class="o">=</span> <span class="n">endianess</span>  <span class="c1"># type: Optional[str]</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The endianess of the data in the file if it is stored in 16 bit integers.  </span>
<span class="sd">        </span>
<span class="sd">        This may be able to be inferred if it is not known and the :attr:`maximum_illumination` value is specified; </span>
<span class="sd">        however, this is not foolproof and may not work.  Therefore, if you know the endianess for 16 bit files you </span>
<span class="sd">        should specify it.  </span>
<span class="sd">        </span>
<span class="sd">        This should be either &#39;&gt;&#39; for big-endian or &#39;&lt;&#39; for little-endian&#39;</span>
<span class="sd">        </span>
<span class="sd">        This must be specified before a call to :meth:`write` if the integer size is 16 bit.  This doesn&#39;t matter if the</span>
<span class="sd">        integer size is 8 bit.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: NONEARRAY</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The actual image data as a 2D numpy array</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>

<div class="viewcode-block" id="Image.read"><a class="viewcode-back" href="../../../utilities/stereophotoclinometry/giant.utilities.stereophotoclinometry.Image.read.html#giant.utilities.stereophotoclinometry.Image.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PATH</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method reads data from a SPC Image file (normally ``IMAGEFILES/*IMAGENAME*.DAT``) and populates the</span>
<span class="sd">        attributes of this class with that data.</span>

<span class="sd">        If ``file_name`` is not specified the :attr:`file_name` attribute of the class is used instead</span>

<span class="sd">        :param file_name: The file to load the sum data from</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">file_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">file_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_rows</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_cols</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The number of rows and columns in the image must be specified before calling read&#39;</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ifile</span><span class="p">:</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">integer_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># get the number of bytes by going to the end of the file, getting the position,</span>
                <span class="c1"># and then rewinding to the beginning of the file</span>
                <span class="n">ifile</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

                <span class="n">num_bytes</span> <span class="o">=</span> <span class="n">ifile</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>

                <span class="n">ifile</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

                <span class="c1"># determine whether this is 1 or 2 byte integers</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">integer_size</span> <span class="o">=</span> <span class="mi">2</span> <span class="k">if</span> <span class="p">(</span><span class="n">num_bytes</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_rows</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_cols</span><span class="p">)</span> <span class="k">else</span> <span class="mi">1</span>

            <span class="c1"># if the data is 2byte</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">integer_size</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">endianess</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

                    <span class="c1"># read in the data as big endian</span>
                    <span class="n">illums_big_e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">ifile</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;&gt;u2&quot;</span><span class="p">,</span> <span class="n">count</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_rows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_cols</span><span class="p">)</span>

                    <span class="c1"># reset back to the beginning of the file</span>
                    <span class="n">ifile</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

                    <span class="c1"># read in the data as little endian</span>
                    <span class="n">illums_little_e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">ifile</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;&lt;u2&quot;</span><span class="p">,</span> <span class="n">count</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_rows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_cols</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">illums_big_e</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">maximum_illumination</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">illums_little_e</span><span class="p">):</span>
                        <span class="c1"># if the data is big endian</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">illums_big_e</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">)</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">endianess</span> <span class="o">=</span> <span class="s1">&#39;&gt;&#39;</span>

                    <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">illums_little_e</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">maximum_illumination</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">illums_big_e</span><span class="p">):</span>
                        <span class="c1"># if the data is little endian</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">illums_little_e</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">)</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">endianess</span> <span class="o">=</span> <span class="s1">&#39;&lt;&#39;</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># otherwise something went wrong</span>
                        <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;It appears like the file has been corrupted (Can&#39;t determine endianness&quot;</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">ifile</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">endianess</span> <span class="o">+</span> <span class="s2">&quot;u2&quot;</span><span class="p">,</span> <span class="n">count</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_rows</span><span class="p">,</span>
                                                                                                  <span class="bp">self</span><span class="o">.</span><span class="n">n_cols</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">ifile</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;u1&quot;</span><span class="p">,</span> <span class="n">count</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_rows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_cols</span><span class="p">)</span></div>

<div class="viewcode-block" id="Image.write"><a class="viewcode-back" href="../../../utilities/stereophotoclinometry/giant.utilities.stereophotoclinometry.Image.write.html#giant.utilities.stereophotoclinometry.Image.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function writes the file contained in the Image object to a dat file</span>

<span class="sd">        If the ``file_name`` argument is not specified then it writes to the file stored in the</span>
<span class="sd">        :attr:`~.Image.file_name` attribute.</span>

<span class="sd">        :param file_name: the full or relative path to the file to be written.  If left as ``None`` then writes to the</span>
<span class="sd">                          file stored in the :attr:`~.Nominal.file_name` attribute</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">file_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">file_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;file_name must be specified&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">integer_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Integer size must be specified to write to a Image file.&quot;</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ofile</span><span class="p">:</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">integer_size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>

                <span class="n">ofile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;u1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tostring</span><span class="p">())</span>

            <span class="k">else</span><span class="p">:</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">endianess</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Endianess must be specified for a 2 byte integer&#39;</span><span class="p">)</span>

                <span class="n">ofile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endianess</span> <span class="o">+</span> <span class="s1">&#39;u2&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tostring</span><span class="p">())</span></div></div>


<div class="viewcode-block" id="Nominal"><a class="viewcode-back" href="../../../utilities/stereophotoclinometry/giant.utilities.stereophotoclinometry.Nominal.html#giant.utilities.stereophotoclinometry.Nominal">[docs]</a><span class="k">class</span> <span class="nc">Nominal</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class is used to read/write from the SPC Nominal (.NOM) files.</span>

<span class="sd">    The nominal files represent meta data about an Image as original loaded with updated values being stored in the</span>
<span class="sd">    Summary (.SUM) files.  The image data itself is stored in a corresponding .DAT file which can be read/written with</span>
<span class="sd">    the :class:`Image` class.  When creating an instance of this class, you can enter the ``file_name`` argument, in</span>
<span class="sd">    which case the specified NOM file will be opened and read into the members of this class (if the file exists), or</span>
<span class="sd">    you can specify the individual components of the file as keyword arguments.  If you specify both an existing</span>
<span class="sd">    NOM file and keyword arguments for the individual components of the NOM file, the keyword arguments will override</span>
<span class="sd">    whatever is read from the file.</span>

<span class="sd">    The documentation for each instance attribute of this class specifies the corresponding location in the NOM file</span>
<span class="sd">    for clarification and reference.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PATH</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">image_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">position_camera_to_target</span><span class="p">:</span> <span class="n">NONEARRAY</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">velocity</span><span class="p">:</span> <span class="n">NONEARRAY</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">rotation_target_fixed_to_camera</span><span class="p">:</span> <span class="n">NONEARRAY</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">sig_pos_camera_to_target</span><span class="p">:</span> <span class="n">NONEARRAY</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">sig_rot_target_fixed_to_camera</span><span class="p">:</span> <span class="n">NONEARRAY</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">frame</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ending</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param file_name: The path to a summary file to read data from</span>
<span class="sd">        :param image_name: The name of the image this object corresponds to</span>
<span class="sd">        :param position_camera_to_target: The vector from the spacecraft to the target in the target body fixed frame as</span>
<span class="sd">                                          a length 3 numpy array as originally specified</span>
<span class="sd">        :param velocity: The velocity of the camera</span>
<span class="sd">        :param rotation_target_fixed_to_camera: The 3x3 rotation matrix from the target body fixed frame to the camera</span>
<span class="sd">                                                frame</span>
<span class="sd">        :param sig_pos_camera_to_target: This is the formal uncertainty on the ``position_camera_to_target`` vector</span>
<span class="sd">                                         (1 sigma) as originally specified</span>
<span class="sd">        :param sig_rot_target_fixed_to_camera: This is the formal uncertainty on the spacecraft pointing</span>
<span class="sd">                                               (roll, pitch, yaw?) (1 sigma) as originally specified</span>
<span class="sd">        :param frame: This specifies the frame the position uncertainty is experessed in</span>
<span class="sd">        :param ending: This specifies stuff that goes at the end of the nominal file.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># predefine the attributes of the class for readability</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Optional[PATH]</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The path to the nominal file that this object was populated from.</span>

<span class="sd">        This also will be the file that changes are written to if :meth:`.write` is called with no arguments.  </span>

<span class="sd">        Typically this is named according to NOMINALS/*IMAGENAME*.NOM where *IMAGENAME* is replaced with the SPC name</span>
<span class="sd">        of the image.  This can be set to None, a str, or a :class:`Path`.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">image_name</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Optional[str]</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The name of the image this object corresponds to.</span>

<span class="sd">        This corresponds to the first line of the NOM file.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">position_camera_to_target</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># type: np.ndarray</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The position vector from the spacecraft to the target in target body fixed coordinates at the time of the image</span>
<span class="sd">        with units of kilometers as a length 3 numpy array of floats.  This represents the vector as originally loaded </span>
<span class="sd">        into SPC (usually from SPICE).  That means this typically is not updated.</span>

<span class="sd">        This corresponds to all the values of the line containing ``SCOBJ`` in the NOM file, usually the 3rd line.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">velocity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># type: np.ndarray</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The velocity of the camera with units of kilometers per second as a length 3 numpy array of floats.</span>
<span class="sd">        </span>
<span class="sd">        This corresponds to the second line in the NOM file.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rotation_target_fixed_to_camera</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>  <span class="c1"># type: np.ndarray</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The rotation matrix from the target body fixed frame to the camera frame at the time of the image as a</span>
<span class="sd">        shape 3x3 numpy array of floats. This represents the matrix as originally read into SPC (usually from spice)</span>

<span class="sd">        This corresponds to all the values of the lines containing ``CX, CY, CZ`` in the NOM file.  The matrix is formed </span>
<span class="sd">        according to ``np.vstack([CX, CY, CZ])`` </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sig_pos_camera_to_target</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># type: np.ndarray</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The formal uncertainty on the position_camera_to_target vector as a length 3 numpy array of floats.</span>

<span class="sd">        The formal uncertainty are the 1 sigma values for each component of the position vector.</span>

<span class="sd">        This corresponds to all of the values of the line containing ``SIGMA_VSO`` in the NOM file.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sig_rot_target_fixed_to_camera</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># type: np.ndarray</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The formal uncertainty on the rotation from the target body frame to the spacecraft frame as a length 3 numpy </span>
<span class="sd">        array of floats.</span>

<span class="sd">        The formal uncertainty are the 1 sigma values.</span>

<span class="sd">        This corresponds to all of the values of the line containing ``SIGMA_PTG`` in the NOM file.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>  <span class="c1"># type: str</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This specifies the frame the sig_pos_camera_to_target is specified in.</span>
<span class="sd">        </span>
<span class="sd">        This corresponds to the label on the velocity line in the NOM file.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ending</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>  <span class="c1"># type: str</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This corresponds to the end of the Nominal file (essentially anything that wasn&#39;t captured) and is a fall back </span>
<span class="sd">        for future additions.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span> <span class="o">=</span> <span class="n">file_name</span>

        <span class="k">if</span> <span class="n">image_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_name</span> <span class="o">=</span> <span class="n">image_name</span>
        <span class="k">if</span> <span class="n">position_camera_to_target</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">position_camera_to_target</span> <span class="o">=</span> <span class="n">position_camera_to_target</span>
        <span class="k">if</span> <span class="n">velocity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">velocity</span> <span class="o">=</span> <span class="n">velocity</span>
        <span class="k">if</span> <span class="n">rotation_target_fixed_to_camera</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rotation_target_fixed_to_camera</span> <span class="o">=</span> <span class="n">rotation_target_fixed_to_camera</span>
        <span class="k">if</span> <span class="n">sig_pos_camera_to_target</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sig_pos_camera_to_target</span> <span class="o">=</span> <span class="n">sig_pos_camera_to_target</span>
        <span class="k">if</span> <span class="n">sig_rot_target_fixed_to_camera</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sig_rot_target_fixed_to_camera</span> <span class="o">=</span> <span class="n">sig_rot_target_fixed_to_camera</span>
        <span class="k">if</span> <span class="n">frame</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">frame</span>
        <span class="k">if</span> <span class="n">ending</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ending</span> <span class="o">=</span> <span class="n">ending</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="n">comp_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;image_name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_name</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">image_name</span><span class="p">,</span>
                     <span class="s1">&#39;position_camera_to_target&#39;</span><span class="p">:</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">position_camera_to_target</span> <span class="o">==</span>
                                                   <span class="n">other</span><span class="o">.</span><span class="n">position_camera_to_target</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
                     <span class="s1">&#39;velocity&#39;</span><span class="p">:</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">velocity</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">velocity</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
                     <span class="s1">&#39;rotation_target_fixed_to_camera&#39;</span><span class="p">:</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rotation_target_fixed_to_camera</span> <span class="o">==</span>
                                                         <span class="n">other</span><span class="o">.</span><span class="n">rotation_target_fixed_to_camera</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
                     <span class="s1">&#39;sig_pos_camera_to_target&#39;</span><span class="p">:</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sig_pos_camera_to_target</span> <span class="o">==</span>
                                                  <span class="n">other</span><span class="o">.</span><span class="n">sig_pos_camera_to_target</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
                     <span class="s1">&#39;sig_rot_target_fixed_to_camera&#39;</span><span class="p">:</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sig_rot_target_fixed_to_camera</span> <span class="o">==</span>
                                                        <span class="n">other</span><span class="o">.</span><span class="n">sig_rot_target_fixed_to_camera</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()}</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">comp_dict</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">comp_dict</span>

<div class="viewcode-block" id="Nominal.read"><a class="viewcode-back" href="../../../utilities/stereophotoclinometry/giant.utilities.stereophotoclinometry.Nominal.read.html#giant.utilities.stereophotoclinometry.Nominal.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PATH</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method reads data from a SPC NOM file (normally ``NOMINALS/*IMAGENAME*.NOM``) and populates the</span>
<span class="sd">        attributes of this class with that data.</span>

<span class="sd">        If ``file_name`` is not specified the :attr:`file_name` attribute of the class is used instead</span>

<span class="sd">        :param file_name: The file to load the sum data from</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">file_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">file_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">nominal</span><span class="p">:</span>
            <span class="c1"># parse the name line</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_name</span> <span class="o">=</span> <span class="n">nominal</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="c1"># read in the spacecraft velocity vector and frame specifier for the uncertainty</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">nominal</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">velocity</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">),</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

            <span class="c1"># read in the spacecraft position vector</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">nominal</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">position_camera_to_target</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

            <span class="c1"># read in the sigma_VSO values (whatever that is)</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">nominal</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">sig_pos_camera_to_target</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

            <span class="c1"># read in the rotation matrix from the body frame to the camera frame</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">nominal</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">rotation_target_fixed_to_camera</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

            <span class="n">line</span> <span class="o">=</span> <span class="n">nominal</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">rotation_target_fixed_to_camera</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

            <span class="n">line</span> <span class="o">=</span> <span class="n">nominal</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">rotation_target_fixed_to_camera</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

            <span class="c1"># read in the sigma_PTG values (whatever that is)</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">nominal</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">sig_rot_target_fixed_to_camera</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">ending</span> <span class="o">=</span> <span class="n">nominal</span><span class="o">.</span><span class="n">read</span><span class="p">()</span></div>

<div class="viewcode-block" id="Nominal.write"><a class="viewcode-back" href="../../../utilities/stereophotoclinometry/giant.utilities.stereophotoclinometry.Nominal.write.html#giant.utilities.stereophotoclinometry.Nominal.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PATH</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function writes the data contained in the current instance of the class into the specified file</span>

<span class="sd">        If the ``file_name`` argument is not specified then it writes to the file stored in the</span>
<span class="sd">        :attr:`~.Nominal.file_name` attribute.</span>

<span class="sd">        :param file_name: the full or relative path to the file to be written.  If left as ``None`` then writes to the</span>
<span class="sd">                          file stored in the :attr:`~.Nominal.file_name` attribute</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">file_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">file_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;file_name must be specified&#39;</span><span class="p">)</span>

        <span class="n">vector_format</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:20.10E}</span><span class="s1"> </span><span class="si">{1:19.10E}</span><span class="s1"> </span><span class="si">{2:19.10E}</span><span class="s1">   &#39;</span>

        <span class="n">name_line</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:s}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_name</span><span class="p">)</span>

        <span class="n">velocity_line</span> <span class="o">=</span> <span class="n">vector_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">velocity</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">position_line</span> <span class="o">=</span> <span class="n">vector_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">position_camera_to_target</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;SCOBJ</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">sig_vso_line</span> <span class="o">=</span> <span class="n">vector_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">sig_pos_camera_to_target</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;SIGMA_VSO</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="n">rot_x_line</span> <span class="o">=</span> <span class="n">vector_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">rotation_target_fixed_to_camera</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;CX</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">rot_y_line</span> <span class="o">=</span> <span class="n">vector_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">rotation_target_fixed_to_camera</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;CY</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">rot_z_line</span> <span class="o">=</span> <span class="n">vector_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">rotation_target_fixed_to_camera</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;CZ</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">sig_ptg_line</span> <span class="o">=</span> <span class="n">vector_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">sig_rot_target_fixed_to_camera</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;SIGMA_PTG</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="c1"># open/create the file for writing</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">nominal</span><span class="p">:</span>
            <span class="n">nominal</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">name_line</span><span class="p">)</span>
            <span class="n">nominal</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">velocity_line</span><span class="p">)</span>
            <span class="n">nominal</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">position_line</span><span class="p">)</span>
            <span class="n">nominal</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">sig_vso_line</span><span class="p">)</span>
            <span class="n">nominal</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">rot_x_line</span><span class="p">)</span>
            <span class="n">nominal</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">rot_y_line</span><span class="p">)</span>
            <span class="n">nominal</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">rot_z_line</span><span class="p">)</span>
            <span class="n">nominal</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">sig_ptg_line</span><span class="p">)</span>
            <span class="n">nominal</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ending</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="Regress"><a class="viewcode-back" href="../../../utilities/stereophotoclinometry/giant.utilities.stereophotoclinometry.Regress.html#giant.utilities.stereophotoclinometry.Regress">[docs]</a><span class="k">class</span> <span class="nc">Regress</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class is used to read from SPC regress files.</span>

<span class="sd">    The regress files summarise the results of performing AUTOREGISTER on a batch of images in a single text file.</span>
<span class="sd">    Typically this is used to ingest SPC landmark observables into navigation software.</span>

<span class="sd">    When creating an instance of this class you can enter the ``file_name`` argument and the data will automatically</span>
<span class="sd">    be read from that file.  Alternatively you can specify individual components of the object through key word</span>
<span class="sd">    arguments.  If you provide both key word arguments and a file name then the key word arguments you specified will</span>
<span class="sd">    overwrite anything read from the file.</span>

<span class="sd">    Currently this class does not support writing regress files.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PATH</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">spc_image_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">orig_image_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">camera_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">spacecraft</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">target_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">observation_date</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ephemeris_time</span><span class="p">:</span> <span class="n">NONENUM</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">n_rows</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">focal_length</span><span class="p">:</span> <span class="n">NONENUM</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">px</span><span class="p">:</span> <span class="n">NONENUM</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">py</span><span class="p">:</span> <span class="n">NONENUM</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">kx</span><span class="p">:</span> <span class="n">NONENUM</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ky</span><span class="p">:</span> <span class="n">NONENUM</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">kxy</span><span class="p">:</span> <span class="n">NONENUM</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">kyx</span><span class="p">:</span> <span class="n">NONENUM</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">titv_mat</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">tpmi_mat</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">sf_pos_sc2obj</span><span class="p">:</span> <span class="n">NONEARRAY</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sf_camera_ra</span><span class="p">:</span> <span class="n">NONENUM</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sf_camera_dec</span><span class="p">:</span> <span class="n">NONENUM</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">sf_camera_twist</span><span class="p">:</span> <span class="n">NONENUM</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">pos_sigma</span><span class="p">:</span> <span class="n">NONENUM</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">pointing_sigma</span><span class="p">:</span> <span class="n">NONENUM</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">twist_sigma</span><span class="p">:</span> <span class="n">NONENUM</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">nom_pos_sc2obj</span><span class="p">:</span> <span class="n">NONENUM</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">nom_camera_ra</span><span class="p">:</span> <span class="n">NONENUM</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">nom_camera_dec</span><span class="p">:</span> <span class="n">NONENUM</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">nom_camera_twist</span><span class="p">:</span> <span class="n">NONENUM</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sun_dir</span><span class="p">:</span> <span class="n">NONEARRAY</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">landmarks</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">lmk_body_fixed_vecs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">lmk_body_fixed_vec_sigmas</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">lmk_observed_pixlines</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">lmk_pred_pixlines</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">lmk_jacobians</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">kernel_list</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param file_name: The name of the regress file to read from</span>
<span class="sd">        :param spc_image_id: The name of the image file according to SPC</span>
<span class="sd">        :param orig_image_name: The name of original image file</span>
<span class="sd">        :param camera_name: The name of the camera</span>
<span class="sd">        :param spacecraft: The name of the spacecraft that hosts the camera</span>
<span class="sd">        :param target_name: The name of the observed target</span>
<span class="sd">        :param observation_date: The observation date in UTC</span>
<span class="sd">        :param ephemeris_time: The observation in ephemeris seconds since J2000</span>
<span class="sd">        :param n_rows: the number of rows in the image</span>
<span class="sd">        :param n_cols: the number of columns in the image</span>
<span class="sd">        :param focal_length: the focal length of the camera</span>
<span class="sd">        :param px: The x component of the principal point of the camera</span>
<span class="sd">        :param py: The y component of the principal point of the camera</span>
<span class="sd">        :param kx: 1/pixel pitch in the x direction</span>
<span class="sd">        :param ky: 1/pixel pitch in the y direction</span>
<span class="sd">        :param kxy: skewness term xy</span>
<span class="sd">        :param kyx: skewness term yx</span>
<span class="sd">        :param titv_mat: I don&#39;t know</span>
<span class="sd">        :param tpmi_mat: Still don&#39;t know</span>
<span class="sd">        :param sf_pos_sc2obj: the solved for position from the spacecraft (camera) to the target in km</span>
<span class="sd">        :param sf_camera_ra: The solved for right ascension of the camera boresight in inertial?</span>
<span class="sd">        :param sf_camera_dec: The solved for declination of the camera boresight in inertial?</span>
<span class="sd">        :param sf_camera_twist: The solved for twist about the camera boresight in inertial?</span>
<span class="sd">        :param pos_sigma: The 1 sigma uncertainty on the position (not sure if pre or post fit)</span>
<span class="sd">        :param pointing_sigma: The 1 sigma uncertainty on the ra/dec pointing (not sure if pre or post fit)</span>
<span class="sd">        :param twist_sigma: The 1 sigma uncertainty on the twist about the boresight (not sure if pre or post fit)</span>
<span class="sd">        :param nom_pos_sc2obj: The nominal (original) position vector from the spacecraft to the target in km</span>
<span class="sd">        :param nom_camera_ra: The nominal (original) right ascension of the camera boresight in intertial?</span>
<span class="sd">        :param nom_camera_dec: The nominal (original) declination of the camera boresight in intertial?</span>
<span class="sd">        :param nom_camera_twist: The nominal (original) twist about the camera boresight in intertial?</span>
<span class="sd">        :param sun_dir: The direction from the target to the sun in the camera frame</span>
<span class="sd">        :param landmarks: A list of landmarks identified in the image</span>
<span class="sd">        :param lmk_body_fixed_vecs:  A list of landmark body fixed locations corresponding to the landmarks list in km</span>
<span class="sd">        :param lmk_body_fixed_vec_sigmas: A list of landmark body fixed location sigmas corresponding to the landmarks</span>
<span class="sd">                                          list</span>
<span class="sd">        :param lmk_observed_pixlines: A list of observed pixel and line (column, row) values for each landmark in the</span>
<span class="sd">                                      landmarks list</span>
<span class="sd">        :param lmk_pred_pixlines: A list of predicted pixel and line (column, row) values for each landmark in the</span>
<span class="sd">                                  landmarks list</span>
<span class="sd">        :param lmk_jacobians: Jacobian matrices of the landmark observables. (with respect to a change in the</span>
<span class="sd">                              spacecraft state?)</span>
<span class="sd">        :param kernel_list: A list of spice kernels that were loaded by spc</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span> <span class="o">=</span> <span class="n">file_name</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The name of the Regress file this data was read from</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">spc_image_id</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The name of the image file according to SPC</span>
<span class="sd">        </span>
<span class="sd">        Corresponds to IMAGE ID in the REGRESS file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">orig_image_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The name of original image file</span>
<span class="sd">        </span>
<span class="sd">        Corresponds to ORIGINAL NAME in the REGRESS file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">camera_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The name of the camera</span>
<span class="sd">        </span>
<span class="sd">        Corresponds to CAMERA ID in the REGRESS file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">spacecraft</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The name of the spacecraft that hosts the camera</span>
<span class="sd">        </span>
<span class="sd">        Corresponds to SPACECRAFT ID in the REGRESS file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">target_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The name of the observed target</span>
<span class="sd">        </span>
<span class="sd">        Corresponds to TARGET ID in the REGRESS file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">observation_date</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The observation date in UTC</span>
<span class="sd">        </span>
<span class="sd">        Corresponds to UTC in the REGRESS file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ephemeris_time</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The observation in ephemeris seconds since J2000</span>
<span class="sd">        </span>
<span class="sd">        Corresponds to ET SEC PAST J2000 in the REGRESS file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">n_rows</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        the number of rows in the image</span>
<span class="sd">        </span>
<span class="sd">        Corresponds to NLN in the REGRESS file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">n_cols</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        the number of columns in the image</span>
<span class="sd">        </span>
<span class="sd">        Corresponds to NPX in the REGRESS file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">focal_length</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        the focal length of the camera</span>
<span class="sd">        </span>
<span class="sd">        Corresponds to MMFL in the REGRESS file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">px</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The x component of the principal point of the camera</span>
<span class="sd">        </span>
<span class="sd">        Corresponds to CTR[0] in the REGRESS file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">py</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The y component of the principal point of the camera</span>
<span class="sd">        </span>
<span class="sd">        Corresponds to CTR[1] in the REGRESS file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">kx</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        1/pixel pitch in the x direction</span>
<span class="sd">        </span>
<span class="sd">        Corresponds to K-MATRIX[0][0] in the REGRESS file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ky</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        1/pixel pitch in the y direction</span>
<span class="sd">        </span>
<span class="sd">        Corresponds to K-MATRIX[1][1] in the REGRESS file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">kxy</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        skewness term xy</span>
<span class="sd">        </span>
<span class="sd">        Corresponds to K-MATRIX[0][1] in the REGRESS file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">kyx</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        skewness term yx</span>
<span class="sd">        </span>
<span class="sd">        Corresponds to K-MATRIX[1][0] in the REGRESS file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">titv_mat</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        I don&#39;t know</span>
<span class="sd">        </span>
<span class="sd">        Corresponds to TITV MATRIX in the REGRESS file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tpmi_mat</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Still don&#39;t know</span>
<span class="sd">        </span>
<span class="sd">        Corresponds to TPMI MATRIX in the REGRESS file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sf_pos_sc2obj</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        the solved for position from the spacecraft (camera) to the target in km</span>
<span class="sd">        </span>
<span class="sd">        Corresponds to SC - OBJ VECTOR in the LITHOS section of the REGRESS file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sf_camera_ra</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The solved for right ascension of the camera boresight in inertial?</span>
<span class="sd">        </span>
<span class="sd">        Corresponds to CAMERA RA in the LITHOS section of the REGRESS file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sf_camera_dec</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The solved for declination of the camera boresight in inertial?</span>
<span class="sd">        </span>
<span class="sd">        Corresponds to CAMERA DC in the LITHOS section of the REGRESS file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sf_camera_twist</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The solved for twist about the camera boresight in inertial?</span>
<span class="sd">        </span>
<span class="sd">        Corresponds to CAMERA TW in the LITHOS section of the REGRESS file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pos_sigma</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The 1 sigma uncertainty on the position (not sure if pre or post fit)</span>
<span class="sd">        </span>
<span class="sd">        Corresponds to S/C POSITION SIG in the LITHOS section of the REGRESS file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pointing_sigma</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The 1 sigma uncertainty on the ra/dec pointing (not sure if pre or post fit)</span>
<span class="sd">        </span>
<span class="sd">        Corresponds to PNT SIGMA (DEG) in the LITHOS section of the REGRESS file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">twist_sigma</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The 1 sigma uncertainty on the twist about the boresight (not sure if pre or post fit)</span>
<span class="sd">        </span>
<span class="sd">        Corresponds to TWIST SIGMA (DEG) in the LITHOS section of the REGRESS file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nom_pos_sc2obj</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The nominal (original) position vector from the spacecraft to the target in km</span>
<span class="sd">        </span>
<span class="sd">        Corresponds to SC - OBJ VECTOR in the NOMINAL STATE section of the REGRESS file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nom_camera_ra</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The nominal (original) right ascension of the camera boresight in intertial?</span>
<span class="sd">        </span>
<span class="sd">        Corresponds to CAMERA RA in the NOMINAL STATE section of the REGRESS file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nom_camera_dec</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The nominal (original) declination of the camera boresight in intertial?</span>
<span class="sd">        </span>
<span class="sd">        Corresponds to CAMERA DC in the NOMINAL STATE section of the REGRESS file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nom_camera_twist</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The nominal (original) twist about the camera boresight in intertial?</span>
<span class="sd">        </span>
<span class="sd">        Corresponds to CAMERA TW in the NOMINAL STATE section of the REGRESS file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sun_dir</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The direction from the target to the sun in the camera frame</span>
<span class="sd">        </span>
<span class="sd">        Corresponds to SOLAR UNIT VECTOR in the NOMINAL STATE section of the REGRESS file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">landmarks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A list of landmarks identified in the image </span>
<span class="sd">        </span>
<span class="sd">        Corresponds to the lines with only 1 entry in the LANDMARKS: section of the REGRESS file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lmk_body_fixed_vecs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A list of landmark body fixed locations corresponding to the landmarks list in km</span>
<span class="sd">        </span>
<span class="sd">        Corresponds to BODY-FIXED VLM in the LANDMARKS: section of the REGRESS file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lmk_body_fixed_vec_sigmas</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A list of landmark body fixed location sigmas corresponding to the landmarks list</span>
<span class="sd">        </span>
<span class="sd">        Corresponds to B-F VLM SIGMA in the LANDMARKS: section of the REGRESS file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lmk_observed_pixlines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A list of observed pixel and line (column, row) values for each landmark in the landmarks list</span>
<span class="sd">        </span>
<span class="sd">        Corresponds to PX, LN OBSERVED in the LANDMARKS: section of the REGRESS file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lmk_pred_pixlines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A list of predicted pixel and line (column, row) values for each landmark in the landmarks list</span>
<span class="sd">        </span>
<span class="sd">        Corresponds to PX, LN PREDICTED in the LANDMARKS: section of the REGRESS file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lmk_jacobians</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Jacobian matrices of the landmark observables. (with respect to a change in the spacecraft state?)</span>
<span class="sd">        </span>
<span class="sd">        Corresponds to DPX/ in the LANDMARKS: section of the REGRESS file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">kernel_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A list of spice kernels that were loaded by spc</span>
<span class="sd">        </span>
<span class="sd">        Corresponds to all entries following KERNEL LIST in the REGRESS file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">spc_image_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spc_image_id</span> <span class="o">=</span> <span class="n">spc_image_id</span>
        <span class="k">if</span> <span class="n">orig_image_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">orig_image_name</span> <span class="o">=</span> <span class="n">orig_image_name</span>
        <span class="k">if</span> <span class="n">camera_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">camera_name</span> <span class="o">=</span> <span class="n">camera_name</span>
        <span class="k">if</span> <span class="n">spacecraft</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spacecraft</span> <span class="o">=</span> <span class="n">spacecraft</span>
        <span class="k">if</span> <span class="n">target_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">target_name</span> <span class="o">=</span> <span class="n">target_name</span>
        <span class="k">if</span> <span class="n">observation_date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">observation_date</span> <span class="o">=</span> <span class="n">observation_date</span>
        <span class="k">if</span> <span class="n">ephemeris_time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ephemeris_time</span> <span class="o">=</span> <span class="n">ephemeris_time</span>
        <span class="k">if</span> <span class="n">n_rows</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">n_rows</span> <span class="o">=</span> <span class="n">n_rows</span>
        <span class="k">if</span> <span class="n">n_cols</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">n_cols</span> <span class="o">=</span> <span class="n">n_cols</span>
        <span class="k">if</span> <span class="n">focal_length</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">focal</span> <span class="o">=</span> <span class="n">focal_length</span>
        <span class="k">if</span> <span class="n">px</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">px</span> <span class="o">=</span> <span class="n">px</span>
        <span class="k">if</span> <span class="n">py</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">py</span> <span class="o">=</span> <span class="n">py</span>
        <span class="k">if</span> <span class="n">kx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kx</span> <span class="o">=</span> <span class="n">kx</span>
        <span class="k">if</span> <span class="n">ky</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ky</span> <span class="o">=</span> <span class="n">ky</span>
        <span class="k">if</span> <span class="n">kxy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kxy</span> <span class="o">=</span> <span class="n">kxy</span>
        <span class="k">if</span> <span class="n">kyx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kyx</span> <span class="o">=</span> <span class="n">kyx</span>
        <span class="k">if</span> <span class="n">titv_mat</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">titv_mat</span> <span class="o">=</span> <span class="n">titv_mat</span>
        <span class="k">if</span> <span class="n">tpmi_mat</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tpmi_mat</span> <span class="o">=</span> <span class="n">tpmi_mat</span>
        <span class="k">if</span> <span class="n">sf_pos_sc2obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sf_pos_sc2obj</span> <span class="o">=</span> <span class="n">sf_pos_sc2obj</span>
        <span class="k">if</span> <span class="n">sf_camera_ra</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sf_camera_ra</span> <span class="o">=</span> <span class="n">sf_camera_ra</span>
        <span class="k">if</span> <span class="n">sf_camera_dec</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sf_camera_dec</span> <span class="o">=</span> <span class="n">sf_camera_dec</span>
        <span class="k">if</span> <span class="n">sf_camera_twist</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sf_camera_twist</span> <span class="o">=</span> <span class="n">sf_camera_twist</span>
        <span class="k">if</span> <span class="n">pos_sigma</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pos_sigma</span> <span class="o">=</span> <span class="n">pos_sigma</span>
        <span class="k">if</span> <span class="n">pointing_sigma</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pointing_sigma</span> <span class="o">=</span> <span class="n">pointing_sigma</span>
        <span class="k">if</span> <span class="n">twist_sigma</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">twist_sigma</span> <span class="o">=</span> <span class="n">twist_sigma</span>
        <span class="k">if</span> <span class="n">nom_pos_sc2obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nom_pos_sc2obj</span> <span class="o">=</span> <span class="n">nom_pos_sc2obj</span>
        <span class="k">if</span> <span class="n">nom_camera_ra</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nom_camera_ra</span> <span class="o">=</span> <span class="n">nom_camera_ra</span>
        <span class="k">if</span> <span class="n">nom_camera_dec</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nom_camera_dec</span> <span class="o">=</span> <span class="n">nom_camera_dec</span>
        <span class="k">if</span> <span class="n">nom_camera_twist</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nom_camera_twist</span> <span class="o">=</span> <span class="n">nom_camera_twist</span>
        <span class="k">if</span> <span class="n">sun_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sun_dir</span> <span class="o">=</span> <span class="n">sun_dir</span>
        <span class="k">if</span> <span class="n">landmarks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">landmarks</span> <span class="o">=</span> <span class="n">landmarks</span>
        <span class="k">if</span> <span class="n">lmk_body_fixed_vecs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lmk_body_fixed_vecs</span> <span class="o">=</span> <span class="n">lmk_body_fixed_vecs</span>
        <span class="k">if</span> <span class="n">lmk_body_fixed_vec_sigmas</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lmk_body_fixed_vec_sigmas</span> <span class="o">=</span> <span class="n">lmk_body_fixed_vec_sigmas</span>
        <span class="k">if</span> <span class="n">lmk_observed_pixlines</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lmk_observed_pixlines</span> <span class="o">=</span> <span class="n">lmk_observed_pixlines</span>
        <span class="k">if</span> <span class="n">lmk_pred_pixlines</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lmk_pred_pixlines</span> <span class="o">=</span> <span class="n">lmk_pred_pixlines</span>
        <span class="k">if</span> <span class="n">lmk_jacobians</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lmk_jacobians</span> <span class="o">=</span> <span class="n">lmk_jacobians</span>
        <span class="k">if</span> <span class="n">kernel_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kernel_list</span> <span class="o">=</span> <span class="n">kernel_list</span>

<div class="viewcode-block" id="Regress.read"><a class="viewcode-back" href="../../../utilities/stereophotoclinometry/giant.utilities.stereophotoclinometry.Regress.read.html#giant.utilities.stereophotoclinometry.Regress.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PATH</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method reads data from a SPC REGRESS file and populates the attributes of</span>
<span class="sd">        this class with that data.</span>

<span class="sd">        If ``file_name`` is not specified the :attr:`file_name` attribute of the class is used instead</span>

<span class="sd">        :param file_name: The file to load the sum data from</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># initialize all the lists</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">titv_mat</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tpmi_mat</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">landmarks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lmk_jacobians</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lmk_pred_pixlines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lmk_observed_pixlines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lmk_body_fixed_vec_sigmas</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lmk_body_fixed_vecs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kernel_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">file_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">file_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">rfile</span><span class="p">:</span>

            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">rfile</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">line</span><span class="p">:</span>

                    <span class="n">upperline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

                    <span class="k">if</span> <span class="s1">&#39;IMAGE ID&#39;</span> <span class="ow">in</span> <span class="n">upperline</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">spc_image_id</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">if</span> <span class="s1">&#39;ORIGINAL NAME&#39;</span> <span class="ow">in</span> <span class="n">upperline</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">orig_image_name</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">if</span> <span class="s1">&#39;CAMERA ID&#39;</span> <span class="ow">in</span> <span class="n">upperline</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">camera_name</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">if</span> <span class="s1">&#39;SPACECRAFT ID&#39;</span> <span class="ow">in</span> <span class="n">upperline</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">spacecraft</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">if</span> <span class="s1">&#39;TARGET ID&#39;</span> <span class="ow">in</span> <span class="n">upperline</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">target_name</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">if</span> <span class="s1">&#39;UTC&#39;</span> <span class="ow">in</span> <span class="n">upperline</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">observation_date</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
                    <span class="k">if</span> <span class="s1">&#39;ET SEC PAST J2000&#39;</span> <span class="ow">in</span> <span class="n">upperline</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ephemeris_time</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">))</span>
                    <span class="k">if</span> <span class="s1">&#39;NPX, NLN&#39;</span> <span class="ow">in</span> <span class="n">upperline</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">n_rows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">n_cols</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="k">if</span> <span class="s1">&#39;MMFL, CTR&#39;</span> <span class="ow">in</span> <span class="n">upperline</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">focal</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">))</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">px</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">))</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">py</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">))</span>
                    <span class="k">if</span> <span class="s1">&#39;K-MATRIX&#39;</span> <span class="ow">in</span> <span class="n">upperline</span><span class="p">:</span>
                        <span class="n">kmat</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">kx</span> <span class="o">=</span> <span class="n">kmat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">kxy</span> <span class="o">=</span> <span class="n">kmat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">kyx</span> <span class="o">=</span> <span class="n">kmat</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ky</span> <span class="o">=</span> <span class="n">kmat</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
                    <span class="k">if</span> <span class="s1">&#39;TITV MATRIX&#39;</span> <span class="ow">in</span> <span class="n">upperline</span><span class="p">:</span>
                        <span class="n">row</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()[:</span><span class="mi">3</span><span class="p">]]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">titv_mat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
                    <span class="k">if</span> <span class="s1">&#39;TPMI MATRIX&#39;</span> <span class="ow">in</span> <span class="n">upperline</span><span class="p">:</span>
                        <span class="n">row</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()[:</span><span class="mi">3</span><span class="p">]]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">tpmi_mat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
                    <span class="k">if</span> <span class="s1">&#39;LITHOS&#39;</span> <span class="ow">in</span> <span class="n">upperline</span><span class="p">:</span>
                        <span class="k">while</span> <span class="s1">&#39;NOMINAL STATE&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">upperline</span><span class="p">:</span>
                            <span class="k">if</span> <span class="s1">&#39;SC - OBJ VECTOR&#39;</span> <span class="ow">in</span> <span class="n">upperline</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">sf_pos_sc2obj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()[:</span><span class="mi">3</span><span class="p">]])</span>
                            <span class="k">if</span> <span class="s1">&#39;CAMERA RA, DC, TW&#39;</span> <span class="ow">in</span> <span class="n">upperline</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">sf_camera_ra</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sf_camera_dec</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sf_camera_twist</span> <span class="o">=</span> \
                                    <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()[:</span><span class="mi">3</span><span class="p">]]</span>
                            <span class="k">if</span> <span class="s1">&#39;S/C POSITION SIG&#39;</span> <span class="ow">in</span> <span class="n">upperline</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">pos_sigma</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">))</span>
                            <span class="k">if</span> <span class="s1">&#39;PNT SIGMA (DEG)&#39;</span> <span class="ow">in</span> <span class="n">upperline</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">pointing_sigma</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">))</span>
                            <span class="k">if</span> <span class="s1">&#39;TWIST SIGMA (DEG)&#39;</span> <span class="ow">in</span> <span class="n">upperline</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">twist_sigma</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">))</span>
                            <span class="n">line</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">rfile</span><span class="p">)</span>
                            <span class="n">upperline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
                    <span class="k">if</span> <span class="s1">&#39;NOMINAL STATE&#39;</span> <span class="ow">in</span> <span class="n">upperline</span><span class="p">:</span>
                        <span class="k">while</span> <span class="s1">&#39;NOMINAL STATE&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">upperline</span><span class="p">:</span>
                            <span class="k">if</span> <span class="s1">&#39;SC - OBJ VECTOR&#39;</span> <span class="ow">in</span> <span class="n">upperline</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">nom_pos_sc2obj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()[:</span><span class="mi">3</span><span class="p">]])</span>
                            <span class="k">if</span> <span class="s1">&#39;CAMERA RA, DC, TW&#39;</span> <span class="ow">in</span> <span class="n">upperline</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">nom_camera_ra</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nom_camera_dec</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nom_camera_twist</span> <span class="o">=</span> \
                                    <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()[:</span><span class="mi">3</span><span class="p">]]</span>
                            <span class="k">if</span> <span class="s1">&#39;SOLAR UNIT VECTOR&#39;</span> <span class="ow">in</span> <span class="n">upperline</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">sun_dir</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()[:</span><span class="mi">3</span><span class="p">]])</span>
                            <span class="n">line</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">rfile</span><span class="p">)</span>
                            <span class="n">upperline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

                    <span class="k">if</span> <span class="s1">&#39;LANDMARKS:&#39;</span> <span class="ow">in</span> <span class="n">upperline</span><span class="p">:</span>
                        <span class="n">line</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">rfile</span><span class="p">)</span>
                        <span class="n">upperline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

                        <span class="k">while</span> <span class="s1">&#39;END LANDMARKS&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">upperline</span><span class="p">:</span>

                            <span class="n">splitline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">splitline</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">landmarks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">splitline</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">lmk_jacobians</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                            <span class="k">if</span> <span class="s1">&#39;BODY-FIXED VLM&#39;</span> <span class="ow">in</span> <span class="n">upperline</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">lmk_body_fixed_vecs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">))</span>
                                                                          <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">splitline</span><span class="p">[:</span><span class="mi">3</span><span class="p">]]))</span>
                            <span class="k">if</span> <span class="s1">&#39;B-F VLM SIGMA&#39;</span> <span class="ow">in</span> <span class="n">upperline</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">lmk_body_fixed_vec_sigmas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">))</span>
                                                                                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">splitline</span><span class="p">[:</span><span class="mi">3</span><span class="p">]]))</span>
                            <span class="k">if</span> <span class="s1">&#39;PX, LN OBSERVED&#39;</span> <span class="ow">in</span> <span class="n">upperline</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">lmk_observed_pixlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">))</span>
                                                                            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">splitline</span><span class="p">[:</span><span class="mi">2</span><span class="p">]]))</span>
                            <span class="k">if</span> <span class="s1">&#39;PX, LN PREDICTED&#39;</span> <span class="ow">in</span> <span class="n">upperline</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">lmk_pred_pixlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">))</span>
                                                                        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">splitline</span><span class="p">[:</span><span class="mi">2</span><span class="p">]]))</span>

                            <span class="k">if</span> <span class="s1">&#39;DPX/&#39;</span> <span class="ow">in</span> <span class="n">upperline</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">lmk_jacobians</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">))</span>
                                                                        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">splitline</span><span class="p">[:</span><span class="mi">2</span><span class="p">]]))</span>

                            <span class="n">line</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">rfile</span><span class="p">)</span>
                            <span class="n">upperline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
                    <span class="k">if</span> <span class="s1">&#39;KERNEL LIST&#39;</span> <span class="ow">in</span> <span class="n">upperline</span><span class="p">:</span>
                        <span class="k">while</span> <span class="s1">&#39;END FILE&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">upperline</span><span class="p">:</span>

                            <span class="k">if</span> <span class="n">line</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">kernel_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

                            <span class="n">line</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">rfile</span><span class="p">)</span>
                            <span class="n">upperline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="Landmark"><a class="viewcode-back" href="../../../utilities/stereophotoclinometry/giant.utilities.stereophotoclinometry.Landmark.html#giant.utilities.stereophotoclinometry.Landmark">[docs]</a><span class="k">class</span> <span class="nc">Landmark</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class is used to read and write from SPC Landmark files.</span>

<span class="sd">    The Landmark files specify information about a landmark (or center of a Maplet).</span>

<span class="sd">    When creating an instance of this class you can enter the ``file_name`` argument and the data will automatically</span>
<span class="sd">    be read from that file.  Alternatively you can specify individual components of the object through key word</span>
<span class="sd">    arguments.  If you provide both key word arguments and a file name then the key word arguments you specified will</span>
<span class="sd">    overwrite anything read from the file.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># TODO: ability to read/write PICTURES, MAP OVERLAYS, and LIMB FITS sections</span>
    <span class="c1"># TODO: update the attribute names to be more descriptive</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PATH</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">scale</span><span class="p">:</span> <span class="n">NONENUM</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sigkm</span><span class="p">:</span> <span class="n">NONENUM</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">rmslmk</span><span class="p">:</span> <span class="n">NONENUM</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">vlm</span><span class="p">:</span> <span class="n">NONEARRAY</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">rot_map2body</span><span class="p">:</span> <span class="n">NONEARRAY</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sigma_lmk</span><span class="p">:</span> <span class="n">NONEARRAY</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param file_name: The name of the landmark file</span>
<span class="sd">        :param name: the name of the landmark</span>
<span class="sd">        :param size: half the size of the corresponding maplet</span>
<span class="sd">        :param scale: The ground sample distance of the corresponding maplet in units of km</span>
<span class="sd">        :param sigkm: The uncertainty of something</span>
<span class="sd">        :param rmslmk: The rms of something</span>
<span class="sd">        :param vlm: the body-fixed landmark vectore</span>
<span class="sd">        :param rot_map2body: the rotation matrix from the corresponding maplet frame to the body fixed frame</span>
<span class="sd">        :param sigma_lmk: the uncertainty on the body fixed landmark vector</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span> <span class="o">=</span> <span class="n">file_name</span>  <span class="c1"># type: Optional[PATH]</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The name of the landmark file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>  <span class="c1"># type: str</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The name of the landmark.  </span>
<span class="sd">        </span>
<span class="sd">        This should be a 6 character string, typically alpha-numeric.</span>
<span class="sd">        </span>
<span class="sd">        This corresponds to the first line of the LMK file.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="mi">49</span>  <span class="c1"># type: int</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Half the number of grid cells on a side for the corresponding Maplet minus 1.</span>
<span class="sd">        </span>
<span class="sd">        This is computed as to size=(n_rows - 1)/2 where n_rows is the number of rows in the corresponding </span>
<span class="sd">        Maplet (or number of columns since Maplets are always square).</span>
<span class="sd">        </span>
<span class="sd">        This corresponds to the first component of the SIZE, SCALE line in the LMK file, usually the second line.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Optional[float]</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The ground sample distance of each grid cell for the corresponding Maplet in units of KM.</span>

<span class="sd">        This corresponds to the second component of the SIZE, SCALE line in the LMK file, usually the second line.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sigkm</span> <span class="o">=</span> <span class="mf">0.15e-3</span>  <span class="c1"># type: float</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The 1 sigma uncertainty on the landmark body fixed vector in units of km?</span>
<span class="sd">        </span>
<span class="sd">        this corresponds to the first component of the SIGKM, RMSLMK line in the LMK file, usually the fourth line.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rmslmk</span> <span class="o">=</span> <span class="mf">0.15e-3</span>  <span class="c1"># type: float</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The residual RMS of the landmark body fixed vector in units of km?</span>

<span class="sd">        This corresponds to the second component of the SIGKM, RMSLMK line in the LMK file, usually the fourth line.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">vlm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># type: np.ndarray</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The body-fixed landmark vector in units of km as a length 3 numpy array of floats</span>
<span class="sd">        </span>
<span class="sd">        This corresponds to all of the components of the VLM line in the LMK file, usually the fifth line.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rot_map2bod</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># type: np.ndarray</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The rotation matrix from the corresponding Maplet local frame to the body-fixed frame as a 3x3 numpy array of </span>
<span class="sd">        floats.</span>
<span class="sd">        </span>
<span class="sd">        This corresponds to all of the components of the UX, UY, and UZ lines in the LMK file, usually lines 6-9.  This </span>
<span class="sd">        matrix is formed according to np.vstack([UX, UY, UZ]).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sigma_lmk</span> <span class="o">=</span> <span class="mf">0.15e-3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># type: np.ndarray</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The 1 sigma uncertainty on all of the components of the landmark body fixed vector in units of km.</span>

<span class="sd">        This corresponds all of the second component of the SIMGA_LMK line in the LMK file, usually the tenth line.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">if</span> <span class="n">size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">size</span>
        <span class="k">if</span> <span class="n">scale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="n">scale</span>
        <span class="k">if</span> <span class="n">sigkm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sigkm</span> <span class="o">=</span> <span class="n">sigkm</span>
        <span class="k">if</span> <span class="n">rmslmk</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rmlmk</span> <span class="o">=</span> <span class="n">rmslmk</span>
        <span class="k">if</span> <span class="n">vlm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vlm</span> <span class="o">=</span> <span class="n">vlm</span>
        <span class="k">if</span> <span class="n">rot_map2body</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rot_map2bod</span> <span class="o">=</span> <span class="n">rot_map2body</span>
        <span class="k">if</span> <span class="n">sigma_lmk</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sigma_lmk</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="Landmark.write"><a class="viewcode-back" href="../../../utilities/stereophotoclinometry/giant.utilities.stereophotoclinometry.Landmark.write.html#giant.utilities.stereophotoclinometry.Landmark.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PATH</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function writes the data contained in the current instance of the class into the specified file</span>

<span class="sd">        If the ``file_name`` argument is not specified then it writes to the file stored in the</span>
<span class="sd">        :attr:`~.Landmark.file_name` attribute.</span>

<span class="sd">        :param file_name: the full or relative path to the file to be written.  If left as ``None`` then writes to the</span>
<span class="sd">                          file stored in the :attr:`~.Landmark.file_name` attribute</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">file_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">file_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;file_name must be specified&#39;</span><span class="p">)</span>

        <span class="n">size_scale_format</span> <span class="o">=</span> <span class="s1">&#39;     </span><span class="si">{:&gt;3d}</span><span class="s1">   </span><span class="si">{:.7f}</span><span class="s1">                                           SIZE, SCALE(KM)</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">sig_format</span> <span class="o">=</span> <span class="s1">&#39;    </span><span class="si">{:16e}</span><span class="s1">   </span><span class="si">{:16e}</span><span class="s1">                       SIGKM, RMSLMK</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">vector_format</span> <span class="o">=</span> <span class="s1">&#39;    </span><span class="si">{:16e}</span><span class="s1">   </span><span class="si">{:16e}</span><span class="s1">   </span><span class="si">{:16e}</span><span class="s1">   </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ofile</span><span class="p">:</span>
            <span class="n">ofile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">   T</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
            <span class="n">ofile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">size_scale_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">))</span>
            <span class="n">ofile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;        -1        -1        -1        -1                       HORIZON</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">ofile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">sig_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sigkm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rmslmk</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">))</span>
            <span class="n">ofile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">vector_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">vlm</span><span class="p">,</span> <span class="s1">&#39;VLN&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">))</span>
            <span class="n">ofile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">vector_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">rot_map2bod</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;UX&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">))</span>
            <span class="n">ofile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">vector_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">rot_map2bod</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;UY&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">))</span>
            <span class="n">ofile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">vector_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">rot_map2bod</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;UZ&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">))</span>
            <span class="n">ofile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">vector_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">sigma_lmk</span><span class="p">,</span> <span class="s1">&#39;SIMGA_LMK&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">))</span>
            <span class="n">ofile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;PICTURES</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">ofile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;MAP OVERLAPS</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">ofile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;LIMB FITS</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">ofile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;END FILE&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Landmark.read"><a class="viewcode-back" href="../../../utilities/stereophotoclinometry/giant.utilities.stereophotoclinometry.Landmark.read.html#giant.utilities.stereophotoclinometry.Landmark.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PATH</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method reads data from a SPC LMK file (normally ``LMKFILES/*MAPLETNAME*.LMK``) and populates the</span>
<span class="sd">        attributes of this class with that data.</span>

<span class="sd">        If ``file_name`` is not specified the :attr:`file_name` attribute of the class is used instead</span>

<span class="sd">        :param file_name: The file to load the LMK data from</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">file_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">file_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;file_name must be specified&#39;</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ifile</span><span class="p">:</span>

            <span class="c1"># parse the name and observation_date lines (first two lines</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">ifile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># parse the size and scale</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">ifile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="c1"># get sigkm and rmslmk</span>
            <span class="n">ifile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>  <span class="c1"># skip the HORIZON line</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">ifile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sigkm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rmlmk</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="c1"># parse the body to landmark position vector</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">ifile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vlm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>

            <span class="c1"># parse the landmark to body rotation matrix</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">ifile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rot_map2bod</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">ifile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rot_map2bod</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">ifile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rot_map2bod</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>

            <span class="c1"># parse the landmark uncertainty</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">ifile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sigma_lmk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="Maplet"><a class="viewcode-back" href="../../../utilities/stereophotoclinometry/giant.utilities.stereophotoclinometry.Maplet.html#giant.utilities.stereophotoclinometry.Maplet">[docs]</a><span class="k">class</span> <span class="nc">Maplet</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class is used to read and write from SPC Maplet files.</span>

<span class="sd">    The Maplet files specify local terrain and albedo data for a landmark.</span>

<span class="sd">    When creating an instance of this class you can enter the ``file_name`` argument and the data will automatically</span>
<span class="sd">    be read from that file.  Alternatively you can specify individual components of the object through key word</span>
<span class="sd">    arguments.  If you provide both key word arguments and a file name then the key word arguments you specified will</span>
<span class="sd">    overwrite anything read from the file.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># TODO: update the attribute names to be more descriptive</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PATH</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">scale</span><span class="p">:</span> <span class="n">NONENUM</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">position_objmap</span><span class="p">:</span> <span class="n">NONEARRAY</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">rotation_maplet2body</span><span class="p">:</span> <span class="n">NONEARRAY</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">hscale</span><span class="p">:</span> <span class="n">NONENUM</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">heights</span><span class="p">:</span> <span class="n">NONEARRAY</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">albedos</span><span class="p">:</span> <span class="n">NONEARRAY</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param file_name: The name of the Maplet file</span>
<span class="sd">        :param name: the name of the Maplet</span>
<span class="sd">        :param size: half the size of the maplet</span>
<span class="sd">        :param scale: The ground sample distance of the maplet in units of km</span>
<span class="sd">        :param position_objmap: the body-fixed center of the maplet (Landmark)</span>
<span class="sd">        :param rotation_maplet2body: The rotation from the local maplet frame to the body fixed frame</span>
<span class="sd">        :param hscale: The scaling term used to convert maplet heights between a float in units of scale and an integer</span>
<span class="sd">                       for file storage.</span>
<span class="sd">        :param heights: The height data for the maplet expressed in the local maplet frame as a 2*size+1 by 2*size+1 2D</span>
<span class="sd">                        numpy array</span>
<span class="sd">        :param albedos: the relative albedo data for the maplet expressed in the local maplet frame as a 2*size+1 by</span>
<span class="sd">                        2*size+1 2D numpy array</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span> <span class="o">=</span> <span class="n">file_name</span>  <span class="c1"># type: Optional[PATH]</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The name of the landmark file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>  <span class="c1"># type: str</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The name of the Maplet.  </span>

<span class="sd">        This should be a 6 character string, typically alpha-numeric.</span>

<span class="sd">        This corresponds to the name of the maplet file, not including the the extension.  It is provided for </span>
<span class="sd">        convenience and is not used in either reading or writing.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="mi">49</span>  <span class="c1"># type: int</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Half the number of grid cells on a side for the Maplet minus 1.</span>

<span class="sd">        This is computed as to size=(n_rows - 1)/2 where n_rows is the number of rows in the </span>
<span class="sd">        Maplet (or number of columns since Maplets are always square).</span>

<span class="sd">        This corresponds to the 16bit unsigned integer in the 11th and 12th bytes of the maplet file.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Optional[float]</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The ground sample distance of each grid cell for the Maplet in units of KM.</span>

<span class="sd">        This corresponds to the 32bit float in the 7th through 10th bytes of the maplet file.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">position_objmap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># type: np.ndarray</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The body-fixed landmark vector in units of km as a length 3 numpy array of floats</span>

<span class="sd">        This corresponds to the 3 32bit floats in the 16th through 28th bytes of the maplet file.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rotation_maplet2body</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>  <span class="c1"># type: np.ndarray</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The rotation matrix from the Maplet local frame to the body-fixed frame as a 3x3 numpy array of </span>
<span class="sd">        floats.</span>

<span class="sd">        This corresponds to the 9 32bit floats in the 29th-55th bytes of the maplet file..</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">hscale</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: NONENUM</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The scale used to convert heights from a float to a 16byte signed integer in the maplet file.</span>
<span class="sd">        </span>
<span class="sd">        This corresponds to the 32bit float in the 56th byte of the maplet file.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">heights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">49</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">49</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>  <span class="c1"># type: np.ndarray</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The height profile for the maplet as a 2*size+1 by 2*size+1 2D numpy array</span>
<span class="sd">        </span>
<span class="sd">        This corresponds to the 16bit signed integers in the remaining data in the maplet file, but have been converted</span>
<span class="sd">        to floats using hscale.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">albedos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">49</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">49</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>  <span class="c1"># type: np.ndarray</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The relative albedo profile for the maplet as a 2*size+1 by 2*size+1 2D numpy array.</span>
<span class="sd">        </span>
<span class="sd">        this corresponds to the 8 bit unsigned integers in the remaining data in the maplet file, but have been </span>
<span class="sd">        converted to floats</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_name</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">if</span> <span class="n">size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">size</span>
        <span class="k">if</span> <span class="n">scale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="n">scale</span>
        <span class="k">if</span> <span class="n">position_objmap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">position_objmap</span> <span class="o">=</span> <span class="n">position_objmap</span>
        <span class="k">if</span> <span class="n">rotation_maplet2body</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rotation_maplet2body</span> <span class="o">=</span> <span class="n">rotation_maplet2body</span>
        <span class="k">if</span> <span class="n">hscale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hscale</span> <span class="o">=</span> <span class="n">hscale</span>
        <span class="k">if</span> <span class="n">heights</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">heights</span> <span class="o">=</span> <span class="n">heights</span>
        <span class="k">if</span> <span class="n">albedos</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">albedos</span> <span class="o">=</span> <span class="n">albedos</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="n">comp_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;scale&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">scale</span><span class="p">,</span>
                     <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
                     <span class="s1">&#39;position_objmap&#39;</span><span class="p">:</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">position_objmap</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">position_objmap</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
                     <span class="s1">&#39;rotation_maplet2body&#39;</span><span class="p">:</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rotation_maplet2body</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">rotation_maplet2body</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
                     <span class="s1">&#39;hscale&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">hscale</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">hscale</span><span class="p">,</span>
                     <span class="s1">&#39;heights&#39;</span><span class="p">:</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">heights</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">heights</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
                     <span class="s1">&#39;albedos&#39;</span><span class="p">:</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">albedos</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">albedos</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()}</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">comp_dict</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">comp_dict</span>

<div class="viewcode-block" id="Maplet.read"><a class="viewcode-back" href="../../../utilities/stereophotoclinometry/giant.utilities.stereophotoclinometry.Maplet.read.html#giant.utilities.stereophotoclinometry.Maplet.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PATH</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method reads data from a SPC Maplet file (normally ``MAPFILES/*MAPLETNAME*.MAP``) and populates the</span>
<span class="sd">        attributes of this class with that data.</span>

<span class="sd">        If ``file_name`` is not specified the :attr:`file_name` attribute of the class is used instead</span>

<span class="sd">        :param file_name: The file to load the MAP data from</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">file_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">file_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;file_name must be specified&#39;</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">map_fileobj</span><span class="p">:</span>
            <span class="c1"># READ IN THE MAPLET HEADER</span>

            <span class="c1"># skip the first six bytes</span>
            <span class="n">map_fileobj</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

            <span class="c1"># read in the scale using numpy&#39;s from file</span>
            <span class="c1"># note that here the &gt; in the dtype indicates big endianess</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">map_fileobj</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;&gt;f4&quot;</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># read in the Maplet size using little endian order because SPC...</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">map_fileobj</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;&lt;u2&#39;</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">map_shape</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

            <span class="c1"># skip the next three bytes from the current position</span>
            <span class="n">map_fileobj</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

            <span class="c1"># read in the body-maplet vector expressed in the body frame</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">position_objmap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">map_fileobj</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;&gt;f4&quot;</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

            <span class="c1"># read in the maplet2body frame rotation matrix.</span>
            <span class="c1"># Need to use reshape to form into a matrix given the vector of data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rotation_maplet2body</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">map_fileobj</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;&gt;f4&quot;</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

            <span class="c1"># read in the height scale</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hscale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">map_fileobj</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;&gt;f4&quot;</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># skip five bytes from the current position</span>
            <span class="n">map_fileobj</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

            <span class="c1"># read in the height and albedo data</span>
            <span class="c1"># read in the data as a structured array where the first element in each tuple is the height data</span>
            <span class="c1"># and the second element in each tuple is the albedo data</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">map_fileobj</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;height&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;i2&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;albedo&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;u1&#39;</span><span class="p">)])</span>

            <span class="c1"># get how much of that is extraneous data by comparing with the total number of elements in the Maplet</span>
            <span class="n">num_pad</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="n">map_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">map_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="c1"># remove the extraneous data from the end</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:</span><span class="o">-</span><span class="n">num_pad</span><span class="p">]</span>

            <span class="c1"># extract the height data from the structured array</span>
            <span class="n">height_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">]</span>

            <span class="c1"># extract the albedo data from the structured array</span>
            <span class="n">albedo_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;albedo&#39;</span><span class="p">]</span>

            <span class="c1"># set the height data to 0 wherever the albedo data is zero</span>
            <span class="n">height_data</span><span class="p">[</span><span class="n">albedo_data</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="c1"># multiply by the height data scale and reshape into the appropriate Maplet size</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">heights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hscale</span> <span class="o">*</span> <span class="n">height_data</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">map_shape</span><span class="p">)</span>

            <span class="c1"># reshape the albedo data into the appropriate Maplet size and change to decimal form</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">albedos</span> <span class="o">=</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="n">albedo_data</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">map_shape</span><span class="p">)</span></div>

<div class="viewcode-block" id="Maplet.write"><a class="viewcode-back" href="../../../utilities/stereophotoclinometry/giant.utilities.stereophotoclinometry.Maplet.write.html#giant.utilities.stereophotoclinometry.Maplet.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PATH</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function writes the data contained in the current instance of the class into the specified file</span>

<span class="sd">        If the ``file_name`` argument is not specified then it writes to the file stored in the</span>
<span class="sd">        :attr:`~.Maplet.file_name` attribute.</span>

<span class="sd">        :param file_name: the full or relative path to the file to be written.  If left as ``None`` then writes to the</span>
<span class="sd">                          file stored in the :attr:`~.Maplet.file_name` attribute</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">file_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">file_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;file_name must be specified&#39;</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">map_fileobj</span><span class="p">:</span>
            <span class="c1"># mark that the first six bytes are not used</span>
            <span class="n">map_fileobj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;UNUSED&#39;</span><span class="p">)</span>

            <span class="c1"># write the Maplet scale as a 4 byte float using big endian encoding</span>
            <span class="n">map_fileobj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&gt;f&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">))</span>

            <span class="c1"># write the Maplet size to file using little endian encoding... because SPC...</span>
            <span class="n">map_fileobj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;H&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>

            <span class="c1"># write the Maplet position and placeholders for the formal uncertainty</span>
            <span class="n">map_fileobj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&gt;xxxfff&#39;</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">position_objmap</span><span class="p">))</span>

            <span class="c1"># write the Maplet to body rotation matrix</span>
            <span class="n">map_fileobj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rotation_maplet2body</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;&gt;f4&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tostring</span><span class="p">())</span>

            <span class="c1"># write in the scaling term for the Maplet height</span>
            <span class="n">map_fileobj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&gt;f&#39;</span> <span class="o">+</span> <span class="s1">&#39;x&#39;</span> <span class="o">*</span> <span class="mi">5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hscale</span><span class="p">))</span>

            <span class="c1"># write in the Maplet height and albedo data</span>
            <span class="c1"># first determine the total number of pixels we have to store</span>
            <span class="n">num_pixels</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>

            <span class="c1"># now determine how many records of 72 bytes that is going to take</span>
            <span class="n">num_records</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="n">num_pixels</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="mi">72</span><span class="p">))</span>

            <span class="c1"># get the number of bytes that we will need to pad to fill up these records</span>
            <span class="n">num_pads</span> <span class="o">=</span> <span class="mi">72</span> <span class="o">*</span> <span class="n">num_records</span> <span class="o">-</span> <span class="n">num_pixels</span> <span class="o">*</span> <span class="mi">3</span>

            <span class="c1"># reshape the matrices into the required format and put the data in the proper format</span>
            <span class="c1"># first we need to scale the height data and round the scaled data to the nearest integers</span>
            <span class="c1"># (because this helps with storage requirements).  Then we use the convenient .reshape(-1)</span>
            <span class="c1"># to form a vector from the matrix, but we can only do this as an array type so we need to</span>
            <span class="c1"># use the asarray method</span>
            <span class="n">height_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">heights</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">hscale</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

            <span class="c1"># do the same thing for the albedo data</span>
            <span class="c1"># noinspection PyArgumentList</span>
            <span class="n">albedo_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">albedos</span> <span class="o">*</span> <span class="mi">200</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">albedos</span><span class="o">.</span><span class="n">max</span><span class="p">())</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

            <span class="c1"># combine into a structured numpy array for creating the binary representation</span>
            <span class="n">map_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">records</span><span class="o">.</span><span class="n">fromarrays</span><span class="p">([</span><span class="n">height_data</span><span class="p">,</span> <span class="n">albedo_data</span><span class="p">],</span>
                                                  <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;heights&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;i2&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;albedos&#39;</span><span class="p">,</span> <span class="s1">&#39;u1&#39;</span><span class="p">)])</span>

            <span class="c1"># write to the file -- note that for the format we write num_pixels pairs of short signed 2 byte integers</span>
            <span class="c1"># with an unsigned character and then pad with num_pads empty space</span>
            <span class="n">map_fileobj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">map_data</span><span class="o">.</span><span class="n">tostring</span><span class="p">()</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span> <span class="o">*</span> <span class="n">num_pads</span><span class="p">)</span></div>

<div class="viewcode-block" id="Maplet.get_triangles"><a class="viewcode-back" href="../../../utilities/stereophotoclinometry/giant.utilities.stereophotoclinometry.Maplet.get_triangles.html#giant.utilities.stereophotoclinometry.Maplet.get_triangles">[docs]</a>    <span class="k">def</span> <span class="nf">get_triangles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">me</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Triangle64</span><span class="p">,</span> <span class="n">Triangle32</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method returns GIANT triangle objects from the maplet data to be used in the GIANT ray tracer</span>

<span class="sd">        :param me: A flag specifying whether to return memory efficient triangles (``True``) or not</span>
<span class="sd">        :return: The GIANT triangles</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># form the column and row labels</span>
        <span class="n">cols</span><span class="p">,</span> <span class="n">rows</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># get the vectors in the maplet frame</span>
        <span class="n">map_vecs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">cols</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">rows</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">heights</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">flatten</span><span class="p">()])</span>

        <span class="c1"># rotate and translate into the body fixed frame</span>
        <span class="n">body_vecs</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">position_objmap</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rotation_maplet2body</span><span class="p">,</span> <span class="n">map_vecs</span><span class="p">))</span>

        <span class="c1"># compute the length of a side</span>
        <span class="n">length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="c1"># make indicies for the tesselation</span>
        <span class="n">tchunk0a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">length</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">length</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint64</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)])</span>
        <span class="n">tchunk0b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">length</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">length</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint64</span><span class="p">)</span>
                              <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)])</span>

        <span class="n">tess0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">tchunk0a</span><span class="p">,</span> <span class="n">tchunk0b</span><span class="p">])</span>

        <span class="n">tchunk1a</span> <span class="o">=</span> <span class="n">tchunk0b</span>
        <span class="n">tchunk1b</span> <span class="o">=</span> <span class="n">tchunk0b</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="n">tess1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">tchunk1a</span><span class="p">,</span> <span class="n">tchunk1b</span><span class="p">])</span>

        <span class="n">tchunk2a</span> <span class="o">=</span> <span class="n">tchunk0a</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">tchunk2b</span> <span class="o">=</span> <span class="n">tchunk2a</span>

        <span class="n">tess2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">tchunk2a</span><span class="p">,</span> <span class="n">tchunk2b</span><span class="p">])</span>

        <span class="n">tess</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">tess0</span><span class="p">,</span> <span class="n">tess2</span><span class="p">,</span> <span class="n">tess1</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="c1"># get the albedos in the proper format</span>
        <span class="n">albs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">albedos</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

        <span class="c1"># form the triangles and return</span>
        <span class="k">if</span> <span class="n">me</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Triangle32</span><span class="p">(</span><span class="n">body_vecs</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">albs</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">tess</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">),</span>
                              <span class="n">compute_reference_ellipsoid</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Triangle64</span><span class="p">(</span><span class="n">body_vecs</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">albs</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">tess</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">),</span>
                              <span class="n">compute_reference_ellipsoid</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div></div>


<span class="k">def</span> <span class="nf">_fortran_float_converter</span><span class="p">(</span><span class="n">in_string</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This utility converts fortran double precision float strings to python float strings by replacing D with e</span>

<span class="sd">    :param in_string: The fortran string containing double precision floats</span>
<span class="sd">    :return: The string ready for ingest by python float utilities</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">in_string</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;e&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="ShapeModel"><a class="viewcode-back" href="../../../utilities/stereophotoclinometry/giant.utilities.stereophotoclinometry.ShapeModel.html#giant.utilities.stereophotoclinometry.ShapeModel">[docs]</a><span class="k">class</span> <span class="nc">ShapeModel</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class is used to read and write from SPC Shape files (Implicitly connected Quadrilateral, ICQ format).</span>

<span class="sd">    The Shape files specify the global terrain for SPC.</span>

<span class="sd">    When creating an instance of this class you can enter the ``file_name`` argument and the data will automatically</span>
<span class="sd">    be read from that file.  Alternatively you can specify individual components of the object through key word</span>
<span class="sd">    arguments.  If you provide both key word arguments and a file name then the key word arguments you specified will</span>
<span class="sd">    overwrite anything read from the file.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PATH</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">conversion</span><span class="p">:</span> <span class="n">Real</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">grid_size</span><span class="p">:</span> <span class="n">NONEARRAY</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">vertices</span><span class="p">:</span> <span class="n">NONEARRAY</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">albedos</span><span class="p">:</span> <span class="n">NONEARRAY</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param file_name: The name of the file to load the data from</span>
<span class="sd">        :param conversion: A conversion factor to convert the units of the shape model into the units you want.</span>
<span class="sd">                           Official SPC shape models are in km, which are the same units GIANT usually uses so this</span>
<span class="sd">                           should typically remain 1.</span>
<span class="sd">        :param grid_size: The number of cells on each side of each face for the ICQ format.  This corresponds to the</span>
<span class="sd">                          number of vertices by ``6*grid_size**2``</span>
<span class="sd">        :param vertices: The vertices for the ICQ format as a nx3 array.  The ordering of these is complicated.</span>
<span class="sd">        :param albedos: The albedos corresponding to the vertices as a nx1 array.  Alternatively can be None if no</span>
<span class="sd">                        albedo data is available.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span> <span class="o">=</span> <span class="n">file_name</span>  <span class="c1"># type: Optional[PATH]</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The name of the shape file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">grid_size</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Optional[int]</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The length of one side of the grid for the ICQ format</span>
<span class="sd">        </span>
<span class="sd">        This corresponds to the first number in the shape file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: NONEARRAY</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The ICQ vertices and a nx3 array</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">albedos</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: NONEARRAY</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The albedo for each vertex as a nx1 array.</span>
<span class="sd">        </span>
<span class="sd">        This is optional and only included in some shape files.  It is the fourth float for each vertex in the shape </span>
<span class="sd">        file if available.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">conversion</span><span class="o">=</span><span class="n">conversion</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">grid_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grid_size</span> <span class="o">=</span> <span class="n">grid_size</span>
        <span class="k">if</span> <span class="n">vertices</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span> <span class="o">=</span> <span class="n">vertices</span>
        <span class="k">if</span> <span class="n">albedos</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">albedos</span> <span class="o">=</span> <span class="n">albedos</span>

<div class="viewcode-block" id="ShapeModel.read"><a class="viewcode-back" href="../../../utilities/stereophotoclinometry/giant.utilities.stereophotoclinometry.ShapeModel.read.html#giant.utilities.stereophotoclinometry.ShapeModel.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PATH</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">conversion</span><span class="p">:</span> <span class="n">Real</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method reads data from a SPC Shape file (normally ``SHAPEFILES/*.TXT``) and populates the attributes</span>
<span class="sd">        of this class with that data.</span>

<span class="sd">        If ``file_name`` is not specified the :attr:`file_name` attribute of the class is used instead.</span>

<span class="sd">        The argument conversion can be used to convert from the SPC units (nominally km) to another unit for the</span>
<span class="sd">        vertices.</span>

<span class="sd">        :param file_name: The file to load the Shape data from</span>
<span class="sd">        :param conversion: The conversion to apply to the verticies to change their units</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">file_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">file_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;file_name must be specified&#39;</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">shape_file</span><span class="p">:</span>

            <span class="c1"># get the grid size for each cube face</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grid_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">shape_file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape_file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">())</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">shape_file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

                <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">([(</span><span class="s1">&#39;vec&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,)),</span> <span class="p">(</span><span class="s1">&#39;albedo&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)])</span>

                <span class="c1"># noinspection PyTypeChecker</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">shape_file</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                  <span class="n">converters</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="n">_fortran_float_converter</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="n">_fortran_float_converter</span><span class="p">,</span>
                                              <span class="mi">2</span><span class="p">:</span> <span class="n">_fortran_float_converter</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="n">_fortran_float_converter</span><span class="p">})</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;vec&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">conversion</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">albedos</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;albedo&#39;</span><span class="p">]</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">shape_file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

                <span class="c1"># noinspection PyTypeChecker</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">shape_file</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                  <span class="n">converters</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="n">_fortran_float_converter</span><span class="p">,</span>
                                              <span class="mi">1</span><span class="p">:</span> <span class="n">_fortran_float_converter</span><span class="p">,</span>
                                              <span class="mi">2</span><span class="p">:</span> <span class="n">_fortran_float_converter</span><span class="p">})</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span> <span class="o">=</span> <span class="n">data</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">albedos</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="ShapeModel.write"><a class="viewcode-back" href="../../../utilities/stereophotoclinometry/giant.utilities.stereophotoclinometry.ShapeModel.write.html#giant.utilities.stereophotoclinometry.ShapeModel.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PATH</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function writes the data contained in the current instance of the class into the specified file</span>

<span class="sd">        If the ``file_name`` argument is not specified then it writes to the file stored in the</span>
<span class="sd">        :attr:`~.ShapeModel.file_name` attribute.</span>

<span class="sd">        :param file_name: the full or relative path to the file to be written.  If left as ``None`` then writes to the</span>
<span class="sd">                          file stored in the :attr:`~.ShapeModel.file_name` attribute</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">file_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">file_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;file_name must be specified&#39;</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ofile</span><span class="p">:</span>
            <span class="n">vec_fmt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:&gt;12.6f}{:&gt;12.6f}{:&gt;12.6f}</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">alb_fmt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:&gt;12.6f}{:&gt;12.6f}{:&gt;12.6f}{:&gt;12.6f}</span><span class="se">\n</span><span class="s1">&#39;</span>

            <span class="n">ofile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:&gt;12d}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_size</span><span class="p">))</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">albedos</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">v</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">albedos</span><span class="p">):</span>
                    <span class="n">ofile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">alb_fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">v</span><span class="p">,</span> <span class="n">a</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">:</span>
                    <span class="n">ofile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">vec_fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">v</span><span class="p">))</span></div>

<div class="viewcode-block" id="ShapeModel.get_triangles"><a class="viewcode-back" href="../../../utilities/stereophotoclinometry/giant.utilities.stereophotoclinometry.ShapeModel.get_triangles.html#giant.utilities.stereophotoclinometry.ShapeModel.get_triangles">[docs]</a>    <span class="k">def</span> <span class="nf">get_triangles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">me</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Triangle64</span><span class="p">,</span> <span class="n">Triangle32</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method returns GIANT triangle objects from the maplet data to be used in the GIANT ray tracer</span>

<span class="sd">        :param me: A flag specifying whether to return memory efficient triangles (``True``) or not</span>
<span class="sd">        :return: The GIANT triangles</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">albedos</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">albedos</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">albedos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">albedos</span>

        <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">icq_indices</span> <span class="o">=</span> <span class="n">indices</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">6</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_size</span><span class="p">))</span>
        <span class="n">triangulated_icq_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">icq_indices</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                                                   <span class="n">icq_indices</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                                                   <span class="n">icq_indices</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:,</span> <span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                                                   <span class="n">icq_indices</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">facets</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">triangulated_icq_indices</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span>
                                 <span class="n">triangulated_icq_indices</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">me</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Triangle32</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span> <span class="n">albedos</span><span class="p">,</span> <span class="n">facets</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Triangle64</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span> <span class="n">albedos</span><span class="p">,</span> <span class="n">facets</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">))</span></div></div>


<div class="viewcode-block" id="get_distortion"><a class="viewcode-back" href="../../../utilities/stereophotoclinometry/giant.utilities.stereophotoclinometry.get_distortion.html#giant.utilities.stereophotoclinometry.get_distortion">[docs]</a><span class="k">def</span> <span class="nf">get_distortion</span><span class="p">(</span><span class="n">image_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">lithos_file</span><span class="p">:</span> <span class="n">PATH</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function gets the distortion value from the lithos file pertaining to a specified image</span>

<span class="sd">    :param image_name:  The name of the Image that the distortion belongs to</span>
<span class="sd">    :param lithos_file:  The lithos file to read from</span>
<span class="sd">    :return distortion: A numpy matrix vector containing the distortion model coefficients.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">distortion</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">lithos_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">lithos</span><span class="p">:</span>

        <span class="n">lithos_lines</span> <span class="o">=</span> <span class="n">lithos</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lithos_lines</span><span class="p">):</span>

            <span class="k">if</span> <span class="n">image_name</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">distortion</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">lithos_lines</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n\t\r</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">),</span>
                                           <span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">distortion</span></div>


<span class="sd">&#39;&#39;&#39;</span>
<span class="sd"># TODO: Move these to unit tests</span>
<span class="sd">if __name__ == &quot;__main__&quot;:</span>

<span class="sd">    import tempfile</span>

<span class="sd">    from contextlib import contextmanager</span>

<span class="sd">    import difflib</span>


<span class="sd">    @contextmanager</span>
<span class="sd">    def tempinput(data):</span>

<span class="sd">        temp = tempfile.NamedTemporaryFile(delete=False)</span>

<span class="sd">        temp.write(data)</span>

<span class="sd">        temp.close()</span>

<span class="sd">        yield temp.name</span>

<span class="sd">        os.unlink(temp.name)</span>


<span class="sd">    sample_sum = b&quot;&quot;&quot;N623721668F1</span>
<span class="sd">2019 OCT 07 12:00:00.008</span>
<span class="sd">  2592  1944     5  4095                                       NPX, NLN, THRSH</span>
<span class="sd">    0.7680000000D+01    0.1296500000D+04    0.9725000000D+03   MMFL, CTR</span>
<span class="sd">    0.2351649185D+00   -0.2809283686D+00    0.8868377173D+00   SCOBJ</span>
<span class="sd">   -0.6317653990D+00    0.6516609256D+00    0.4197743664D+00   CX</span>
<span class="sd">   -0.6953193648D+00   -0.7157809166D+00    0.6471986115D-01   CY</span>
<span class="sd">    0.3426418853D+00   -0.2509894769D+00    0.9053180772D+00   CZ</span>
<span class="sd">    0.9046070715D+00    0.4179848898D+00   -0.8351453790D-01   SZ</span>
<span class="sd"> 454.54000   0.00000   0.00000   0.00000 454.54000   0.00000   K-MATRIX</span>
<span class="sd">    0.00000D+00    0.00000D+00    0.00000D+00    0.00000D+00   DISTORTION</span>
<span class="sd">    0.3129597577D-03    0.3131765583D-03    0.3130389276D-03   SIGMA_VSO</span>
<span class="sd">    0.5226008432D-03    0.5425981305D-03    0.1994887106D-02   SIGMA_PTG</span>
<span class="sd">LANDMARKS</span>
<span class="sd">BM0071   2118.75    734.66</span>
<span class="sd">BM0072   1859.93    495.69</span>
<span class="sd">BM0073   1555.02    379.77</span>
<span class="sd">BM0085   1756.97    711.28</span>
<span class="sd">BM0086   1388.49    551.32</span>
<span class="sd">BM0087   1010.84    563.61</span>
<span class="sd">BM0088    735.15    947.80</span>
<span class="sd">BM0095   1373.05    861.46</span>
<span class="sd">BM0096   1036.84    783.76</span>
<span class="sd">LIMB FITS</span>
<span class="sd">END FILE&quot;&quot;&quot;</span>

<span class="sd">    with tempinput(sample_sum) as in_file:</span>

<span class="sd">        sum_in = Summary(in_file)</span>

<span class="sd">        with tempinput(b&#39;&#39;) as out_file:</span>

<span class="sd">            sum_in.write(out_file)</span>

<span class="sd">            sum_out = Summary(out_file)</span>

<span class="sd">            comp = sum_in == sum_out</span>

<span class="sd">            if not isinstance(comp, bool):</span>

<span class="sd">                print(comp)</span>

<span class="sd">                with open(out_file, &#39;r&#39;) as out_data:</span>

<span class="sd">                    out_text = out_data.read().splitlines(keepends=True)</span>

<span class="sd">                    diff = difflib.Differ()</span>

<span class="sd">                    print(&#39;&#39;.join(diff.compare(sample_sum.decode().splitlines(keepends=True), out_text)))</span>

<span class="sd">            else:</span>
<span class="sd">                print(&#39;Summary Success&#39;)</span>

<span class="sd">    sample_nom = b&quot;&quot;&quot;N623728868F1</span>
<span class="sd">   -0.2811837848D+00    0.5804346431D+00   -0.7642194084D+00   BOD_FRAME</span>
<span class="sd">   -0.5044891352D+00    0.6056100257D+00    0.5819377357D+00   SCOBJ</span>
<span class="sd">    0.1000000000D-02    0.1000000000D-02    0.1000000000D-02   SIGMA_VSO</span>
<span class="sd">    0.5393528366D+00   -0.2528761844D+00    0.8032136410D+00   CX</span>
<span class="sd">    0.5932654478D+00    0.7910347948D+00   -0.1493320524D+00   CY</span>
<span class="sd">   -0.5976074180D+00    0.5570615665D+00    0.5766695632D+00   CZ</span>
<span class="sd">    0.3000000000D-02    0.3000000000D-02    0.3000000000D-02   SIGMA_PTG</span>
<span class="sd">END FILE&quot;&quot;&quot;</span>

<span class="sd">    with tempinput(sample_nom) as in_file:</span>

<span class="sd">        nom_in = Nominal(in_file)</span>

<span class="sd">        with tempinput(b&#39;&#39;) as out_file:</span>

<span class="sd">            nom_in.write_nom(out_file)</span>

<span class="sd">            nom_out = Nominal(out_file)</span>

<span class="sd">            comp = nom_in == nom_out</span>

<span class="sd">            if not isinstance(comp, bool):</span>

<span class="sd">                print(comp)</span>

<span class="sd">                with open(out_file, &#39;r&#39;) as out_data:</span>

<span class="sd">                    out_text = out_data.read().splitlines(keepends=True)</span>

<span class="sd">                    diff = difflib.Differ()</span>

<span class="sd">                    print(&#39;&#39;.join(diff.compare(sample_nom.decode().splitlines(keepends=True), out_text)))</span>

<span class="sd">            else:</span>
<span class="sd">                print(&#39;Nominal Success&#39;)</span>

<span class="sd">    map_file = &#39;/Users/aliounis/Documents/ODTT3B_filestructure/Run1/MAPFILES/BM0007.MAP&#39;</span>

<span class="sd">    maplet = Maplet(map_file)</span>

<span class="sd">    with tempinput(b&#39;&#39;) as out_file:</span>

<span class="sd">        maplet.write(out_file)</span>

<span class="sd">        map_out = Maplet(out_file)</span>

<span class="sd">        comp = maplet == map_out</span>

<span class="sd">        if not isinstance(comp, bool):</span>

<span class="sd">            print(comp)</span>

<span class="sd">        else:</span>

<span class="sd">            print(&#39;Maplet Success&#39;)</span>


<span class="sd">    # shape_file = &#39;/Users/aliounis/GDrive/Work/DAWN_VESTA_File_Structure/Vesta/SHAPEFILES/SHAPE0.TXT&#39;</span>
<span class="sd">    shape_file = &#39;/Users/aliounis/Repos/spcmc/realdata/CleanDir/SHAPEFILES/SHAPE.TXT&#39;</span>

<span class="sd">    shape_model = ShapeModel(shape_file)</span>

<span class="sd">    print(&#39;stop&#39;)</span>

<span class="sd">    # import matplotlib.pyplot as plt</span>

<span class="sd">    # shape_obj.shapeobj.plot()</span>

<span class="sd">    # plt.show()</span>
<span class="sd">&#39;&#39;&#39;</span>
</pre></div>

          </div>
              <div class="related bottom">
                &nbsp;
  <nav id="rellinks">
    <ul>
    </ul>
  </nav>
              </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;2021 United States Government.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.3.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>